!function(e,t){e.Long=t()}(this,function(){"use strict";function e(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function t(e){return(e&&e.__isLong__)===!0}function n(e,t){var n,o,r;return t?(e>>>=0,(r=0<=e&&e<256)&&(o=a[e])?o:(n=i(e,(0|e)<0?-1:0,!0),r&&(a[e]=n),n)):(e|=0,(r=-128<=e&&e<128)&&(o=u[e])?o:(n=i(e,e<0?-1:0,!1),r&&(u[e]=n),n))}function o(e,t){if(isNaN(e)||!isFinite(e))return t?I:h;if(t){if(e<0)return I;if(e>=f)return T}else{if(e<=-d)return C;if(e+1>=d)return y}return e<0?o(-e,t).neg():i(e%g|0,e/g|0,t)}function i(t,n,o){return new e(t,n,o)}function r(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return h;if("number"==typeof t?(n=t,t=!1):t=!!t,n=n||10,n<2||36<n)throw RangeError("radix");var i;if((i=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===i)return r(e.substring(1),t,n).neg();for(var s=o(c(n,8)),u=h,a=0;a<e.length;a+=8){var l=Math.min(8,e.length-a),p=parseInt(e.substring(a,a+l),n);if(l<8){var g=o(c(n,l));u=u.mul(g).add(o(p))}else u=u.mul(s),u=u.add(o(p))}return u.unsigned=t,u}function s(t){return t instanceof e?t:"number"==typeof t?o(t):"string"==typeof t?r(t):i(t.low,t.high,t.unsigned)}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),e.isLong=t;var u={},a={};e.fromInt=n,e.fromNumber=o,e.fromBits=i;var c=Math.pow;e.fromString=r,e.fromValue=s;var l=65536,p=1<<24,g=l*l,f=g*g,d=f/2,m=n(p),h=n(0);e.ZERO=h;var I=n(0,!0);e.UZERO=I;var E=n(1);e.ONE=E;var M=n(1,!0);e.UONE=M;var _=n(-1);e.NEG_ONE=_;var y=i(-1,2147483647,!1);e.MAX_VALUE=y;var T=i(-1,-1,!0);e.MAX_UNSIGNED_VALUE=T;var C=i(0,-2147483648,!1);e.MIN_VALUE=C;var A=e.prototype;return A.toInt=function(){return this.unsigned?this.low>>>0:this.low},A.toNumber=function(){return this.unsigned?(this.high>>>0)*g+(this.low>>>0):this.high*g+(this.low>>>0)},A.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(C)){var t=o(e),n=this.div(t),i=n.mul(t).sub(this);return n.toString(e)+i.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var r=o(c(e,6),this.unsigned),s=this,u="";;){var a=s.div(r),l=s.sub(a.mul(r)).toInt()>>>0,p=l.toString(e);if(s=a,s.isZero())return p+u;for(;p.length<6;)p="0"+p;u=""+p+u}},A.getHighBits=function(){return this.high},A.getHighBitsUnsigned=function(){return this.high>>>0},A.getLowBits=function(){return this.low},A.getLowBitsUnsigned=function(){return this.low>>>0},A.getNumBitsAbs=function(){if(this.isNegative())return this.eq(C)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},A.isZero=function(){return 0===this.high&&0===this.low},A.isNegative=function(){return!this.unsigned&&this.high<0},A.isPositive=function(){return this.unsigned||this.high>=0},A.isOdd=function(){return 1===(1&this.low)},A.isEven=function(){return 0===(1&this.low)},A.equals=function(e){return t(e)||(e=s(e)),(this.unsigned===e.unsigned||this.high>>>31!==1||e.high>>>31!==1)&&(this.high===e.high&&this.low===e.low)},A.eq=A.equals,A.notEquals=function(e){return!this.eq(e)},A.neq=A.notEquals,A.lessThan=function(e){return this.comp(e)<0},A.lt=A.lessThan,A.lessThanOrEqual=function(e){return this.comp(e)<=0},A.lte=A.lessThanOrEqual,A.greaterThan=function(e){return this.comp(e)>0},A.gt=A.greaterThan,A.greaterThanOrEqual=function(e){return this.comp(e)>=0},A.gte=A.greaterThanOrEqual,A.compare=function(e){if(t(e)||(e=s(e)),this.eq(e))return 0;var n=this.isNegative(),o=e.isNegative();return n&&!o?-1:!n&&o?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},A.comp=A.compare,A.negate=function(){return!this.unsigned&&this.eq(C)?C:this.not().add(E)},A.neg=A.negate,A.add=function(e){t(e)||(e=s(e));var n=this.high>>>16,o=65535&this.high,r=this.low>>>16,u=65535&this.low,a=e.high>>>16,c=65535&e.high,l=e.low>>>16,p=65535&e.low,g=0,f=0,d=0,m=0;return m+=u+p,d+=m>>>16,m&=65535,d+=r+l,f+=d>>>16,d&=65535,f+=o+c,g+=f>>>16,f&=65535,g+=n+a,g&=65535,i(d<<16|m,g<<16|f,this.unsigned)},A.subtract=function(e){return t(e)||(e=s(e)),this.add(e.neg())},A.sub=A.subtract,A.multiply=function(e){if(this.isZero())return h;if(t(e)||(e=s(e)),e.isZero())return h;if(this.eq(C))return e.isOdd()?C:h;if(e.eq(C))return this.isOdd()?C:h;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(m)&&e.lt(m))return o(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,r=65535&this.high,u=this.low>>>16,a=65535&this.low,c=e.high>>>16,l=65535&e.high,p=e.low>>>16,g=65535&e.low,f=0,d=0,I=0,E=0;return E+=a*g,I+=E>>>16,E&=65535,I+=u*g,d+=I>>>16,I&=65535,I+=a*p,d+=I>>>16,I&=65535,d+=r*g,f+=d>>>16,d&=65535,d+=u*p,f+=d>>>16,d&=65535,d+=a*l,f+=d>>>16,d&=65535,f+=n*g+r*p+u*l+a*c,f&=65535,i(I<<16|E,f<<16|d,this.unsigned)},A.mul=A.multiply,A.divide=function(e){if(t(e)||(e=s(e)),e.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?I:h;var n,i,r;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return I;if(e.gt(this.shru(1)))return M;r=I}else{if(this.eq(C)){if(e.eq(E)||e.eq(_))return C;if(e.eq(C))return E;var u=this.shr(1);return n=u.div(e).shl(1),n.eq(h)?e.isNegative()?E:_:(i=this.sub(e.mul(n)),r=n.add(i.div(e)))}if(e.eq(C))return this.unsigned?I:h;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();r=h}for(i=this;i.gte(e);){n=Math.max(1,Math.floor(i.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(n)/Math.LN2),l=a<=48?1:c(2,a-48),p=o(n),g=p.mul(e);g.isNegative()||g.gt(i);)n-=l,p=o(n,this.unsigned),g=p.mul(e);p.isZero()&&(p=E),r=r.add(p),i=i.sub(g)}return r},A.div=A.divide,A.modulo=function(e){return t(e)||(e=s(e)),this.sub(this.div(e).mul(e))},A.mod=A.modulo,A.not=function(){return i(~this.low,~this.high,this.unsigned)},A.and=function(e){return t(e)||(e=s(e)),i(this.low&e.low,this.high&e.high,this.unsigned)},A.or=function(e){return t(e)||(e=s(e)),i(this.low|e.low,this.high|e.high,this.unsigned)},A.xor=function(e){return t(e)||(e=s(e)),i(this.low^e.low,this.high^e.high,this.unsigned)},A.shiftLeft=function(e){return t(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?i(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):i(0,this.low<<e-32,this.unsigned)},A.shl=A.shiftLeft,A.shiftRight=function(e){return t(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?i(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):i(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},A.shr=A.shiftRight,A.shiftRightUnsigned=function(e){if(t(e)&&(e=e.toInt()),e&=63,0===e)return this;var n=this.high;if(e<32){var o=this.low;return i(o>>>e|n<<32-e,n>>>e,this.unsigned)}return 32===e?i(n,0,this.unsigned):i(n>>>e-32,0,this.unsigned)},A.shru=A.shiftRightUnsigned,A.toSigned=function(){return this.unsigned?i(this.low,this.high,!1):this},A.toUnsigned=function(){return this.unsigned?this:i(this.low,this.high,!0)},A.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},A.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24&255,255&e,e>>>8&255,e>>>16&255,e>>>24&255]},A.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24&255,e>>>16&255,e>>>8&255,255&e,t>>>24&255,t>>>16&255,t>>>8&255,255&t]},e});var webim={login:function(e,t,n){},syncMsgs:function(e,t){},getC2CHistoryMsgs:function(e,t,n){},syncGroupMsgs:function(e,t,n){},sendMsg:function(e,t,n){},logout:function(e,t){},setAutoRead:function(e,t,n){},getProfilePortrait:function(e,t,n){},setProfilePortrait:function(e,t,n){},applyAddFriend:function(e,t,n){},getPendency:function(e,t,n){},deletePendency:function(e,t,n){},responseFriend:function(e,t,n){},getAllFriend:function(e,t,n){},deleteFriend:function(e,t,n){},addBlackList:function(e,t,n){},getBlackList:function(e,t,n){},deleteBlackList:function(e,t,n){},uploadPic:function(e,t,n){},createGroup:function(e,t,n){},applyJoinGroup:function(e,t,n){},handleApplyJoinGroup:function(e,t,n){},deleteApplyJoinGroupPendency:function(e,t,n){},quitGroup:function(e,t,n){},getGroupPublicInfo:function(e,t,n){},getGroupInfo:function(e,t,n){},modifyGroupBaseInfo:function(e,t,n){},destroyGroup:function(e,t,n){},getJoinedGroupListHigh:function(e,t,n){},getGroupMemberInfo:function(e,t,n){},addGroupMember:function(e,t,n){},modifyGroupMember:function(e,t,n){},forbidSendMsg:function(e,t,n){},deleteGroupMember:function(e,t,n){},getPendencyGroup:function(e,t,n){},getPendencyReport:function(e,t,n){},getPendencyGroupRead:function(e,t,n){},sendCustomGroupNotify:function(e,t,n){},Msg:function(e,t,n,o,i,r,s,u){},MsgStore:{sessMap:function(){return{}},sessCount:function(){return 0},sessByTypeId:function(e,t){return{}},delSessByTypeId:function(e,t){return!0},resetCookieAndSyncFlag:function(){},downloadMap:{}}};!function(e){var t,n={VERSION:"1.7.0",APPID:"537048168",PLAATFORM:"10"},o=!0,i={FORMAL:{COMMON:"https://webim.tim.qq.com",PIC:"https://pic.tim.qq.com"},TEST:{COMMON:"https://test.tim.qq.com",PIC:"https://pic.tim.qq.com"}},r={},s=!1,u={OPEN_IM:"openim",GROUP:"group_open_http_svc",FRIEND:"sns",PROFILE:"profile",RECENT_CONTACT:"recentcontact",PIC:"openpic",BIG_GROUP:"group_open_http_noauth_svc",BIG_GROUP_LONG_POLLING:"group_open_long_polling_http_noauth_svc",IM_OPEN_STAT:"imopenstat"},a={openim:"v4",group_open_http_svc:"v4",sns:"v4",profile:"v4",recentcontact:"v4",openpic:"v4",group_open_http_noauth_svc:"v1",group_open_long_polling_http_noauth_svc:"v1",imopenstat:"v4"},c={login:1,pic_up:3,apply_join_group:9,create_group:10,longpolling:18,send_group_msg:19,sendmsg:20},l={C2C:"C2C",GROUP:"GROUP"},p={C2C:1,GROUP:2},g={C2C:12e3,GROUP:8898},f={OK:"OK",FAIL:"FAIL"},d=99999,m={TEXT:"TIMTextElem",FACE:"TIMFaceElem",IMAGE:"TIMImageElem",CUSTOM:"TIMCustomElem",SOUND:"TIMSoundElem",FILE:"TIMFileElem",LOCATION:"TIMLocationElem",GROUP_TIP:"TIMGroupTipElem"},h={ORIGIN:1,LARGE:2,SMALL:3},I={RAW_DATA:0,BASE64_DATA:1},E={BUSSINESS_ID:"10001",AUTH_KEY:"617574686b6579",SERVER_IP:"182.140.186.147"},M={SOUND:2106,FILE:2107},_={IMAGE:1,FILE:2,SHORT_VIDEO:3,SOUND:4},y={APP_VERSION:"2.1",SERVER_VERSION:1},T={C2C:1,GROUP_COMMON:3,GROUP_TIP:4,GROUP_SYSTEM:5,GROUP_TIP2:6,FRIEND_NOTICE:7,PROFILE_NOTICE:8,C2C_COMMON:9,C2C_EVENT:10},C={COMMON:0},A={READED:92},S={COMMON:0,LOVEMSG:1,TIP:2,REDPACKET:3},v={REDPACKET:1,COMMON:2,LOVEMSG:3},O={JOIN:1,QUIT:2,KICK:3,SET_ADMIN:4,CANCEL_ADMIN:5,MODIFY_GROUP_INFO:6,MODIFY_MEMBER_INFO:7},R={FACE_URL:1,NAME:2,OWNER:3,NOTIFICATION:4,INTRODUCTION:5},G={JOIN_GROUP_REQUEST:1,JOIN_GROUP_ACCEPT:2,JOIN_GROUP_REFUSE:3,KICK:4,DESTORY:5,CREATE:6,INVITED_JOIN_GROUP_REQUEST:7,QUIT:8,SET_ADMIN:9,CANCEL_ADMIN:10,REVOKE:11,READED:15,CUSTOM:255,INVITED_JOIN_GROUP_REQUEST_AGREE:12},N={FRIEND_ADD:1,FRIEND_DELETE:2,PENDENCY_ADD:3,PENDENCY_DELETE:4,BLACK_LIST_ADD:5,BLACK_LIST_DELETE:6,PENDENCY_REPORT:7,FRIEND_UPDATE:8},F={PROFILE_MODIFY:1},b={OK:0,SIGNATURE_EXPIRATION:11},P={INIT:-1,ON:0,RECONNECT:1,OFF:9999},L={GROUP_MSG:1,C2C_MSG:2,USER_HEAD:3,GROUP_HEAD:4},w={ING:14,STOP:15},U=15e3,D=10,k=P.INIT,q=!1,x=0,B=6e4,K=5e3,V=60008,H=91101,J=null,z=0,Y=10,X=0,j=20,Q=0,W=null,Z=null,$=0,ee=[],te=null,ne=null,oe={sdkAppID:null,appIDAt3rd:null,accountType:null,identifier:null,tinyid:null,identifierNick:null,userSig:null,a2:null,contentType:"json",apn:1},ie={},re=0,se={},ue=0,ae=[],ce=[],le=20,pe=[],ge={downloadMap:{}},fe={},de={},me=new function(){this.formatTimeStamp=function(e,t){if(!e)return 0;var n;t=t||"yyyy-MM-dd hh:mm:ss";var o=new Date(1e3*e),i={"M+":o.getMonth()+1,"d+":o.getDate(),"h+":o.getHours(),"m+":o.getMinutes(),"s+":o.getSeconds()};n=/(y+)/.test(t)?t.replace(RegExp.$1,(o.getFullYear()+"").substr(4-RegExp.$1.length)):t;for(var r in i)new RegExp("("+r+")").test(n)&&(n=n.replace(RegExp.$1,1==RegExp.$1.length?i[r]:("00"+i[r]).substr((""+i[r]).length)));return n},this.groupTypeEn2Ch=function(e){var t=null;switch(e){case"Public":t="公开群";break;case"ChatRoom":t="聊天室";break;case"Private":t="私有群";break;case"AVChatRoom":t="直播聊天室";break;default:t=e}return t},this.groupTypeCh2En=function(e){var t=null;switch(e){case"公开群":t="Public";break;case"聊天室":t="ChatRoom";break;case"私有群":t="Private";break;case"直播聊天室":t="AVChatRoom";break;default:t=e}return t},this.groupRoleEn2Ch=function(e){var t=null;switch(e){case"Member":t="成员";break;case"Admin":t="管理员";break;case"Owner":t="群主";break;default:t=e}return t},this.groupRoleCh2En=function(e){var t=null;switch(e){case"成员":t="Member";break;case"管理员":t="Admin";break;case"群主":t="Owner";break;default:t=e}return t},this.groupMsgFlagEn2Ch=function(e){var t=null;switch(e){case"AcceptAndNotify":t="接收并提示";break;case"AcceptNotNotify":t="接收不提示";break;case"Discard":t="屏蔽";break;default:t=e}return t},this.groupMsgFlagCh2En=function(e){var t=null;switch(e){case"接收并提示":t="AcceptAndNotify";break;case"接收不提示":t="AcceptNotNotify";break;case"屏蔽":t="Discard";break;default:t=e}return t},this.formatText2Html=function(e){var t=e;return t&&(t=this.xssFilter(t),t=t.replace(/ /g,"&nbsp;"),t=t.replace(/\n/g,"<br/>")),t},this.formatHtml2Text=function(e){var t=e;return t&&(t=t.replace(/&nbsp;/g," "),t=t.replace(/<br\/>/g,"\n")),t},this.getStrBytes=function(e){if(null==e||void 0===e)return 0;if("string"!=typeof e)return 0;var t,n,o,i=0;for(n=0,o=e.length;n<o;n++)t=e.charCodeAt(n),i+=t<=127?1:t<=2047?2:t<=65535?3:4;return i},this.xssFilter=function(e){return e=e.toString(),e=e.replace(/[<]/g,"&lt;"),e=e.replace(/[>]/g,"&gt;"),e=e.replace(/"/g,"&quot;")},this.trimStr=function(e){return e?(e=e.toString(),e.replace(/(^\s*)|(\s*$)/g,"")):""},this.validNumber=function(e){return e=e.toString(),e.match(/(^\d{1,8}$)/g)},this.getReturnError=function(e,t){t||(t=-100);var n={ActionStatus:f.FAIL,ErrorCode:t,ErrorInfo:e+"["+t+"]"};return n},this.setCookie=function(e,t,n,o,i){var r=new Date;r.setTime(r.getTime()+1e3*n),document.cookie=e+"="+escape(t)+";expires="+r.toGMTString()},this.getCookie=function(e){var t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));return null!=t?unescape(t[2]):null},this.delCookie=function(e){var t=new Date;t.setTime(t.getTime()-1);var n=this.getCookie(e);null!=n&&(document.cookie=e+"="+escape(n)+";expires="+t.toGMTString())},this.getQueryString=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(t);return null!=n?unescape(n[2]):null},this.isIE=function(e){var t=document.createElement("b");return t.innerHTML="<!--[if IE "+e+"]><i></i><![endif]-->",1===t.getElementsByTagName("i").length},this.getBrowserInfo=function(){var e={},t=navigator.userAgent.toLowerCase();he.info("navigator.userAgent="+t);var n;return(n=t.match(/msie ([\d.]+)/))?e.ie=n[1]:(n=t.match(/firefox\/([\d.]+)/))?e.firefox=n[1]:(n=t.match(/chrome\/([\d.]+)/))?e.chrome=n[1]:(n=t.match(/opera.([\d.]+)/))?e.opera=n[1]:(n=t.match(/version\/([\d.]+).*safari/))?e.safari=n[1]:0,e.ie?(t.match(/trident\/(\d)\./)&&6==t.match(/trident\/(\d)\./)[1]&&(e.ie=10),{type:"ie",ver:e.ie}):e.firefox?{type:"firefox",ver:e.firefox}:e.chrome?{type:"chrome",ver:e.chrome}:e.opera?{type:"opera",ver:e.opera}:e.safari?{type:"safari",ver:e.safari}:{type:"unknow",ver:-1}}},he=new function(){var e=!0;this.setOn=function(t){e=t},this.getOn=function(){return e},this.error=function(t){try{e&&console.error(t)}catch(e){}},this.warn=function(t){try{e&&console.warn(t)}catch(e){}},this.info=function(t){try{e&&console.info(t)}catch(e){}},this.debug=function(t){try{e&&console.debug(t)}catch(e){}}},Ie=function(e){return e||(e=new Date),Math.round(e.getTime()/1e3)},Ee=function(){return ue?ue+=1:ue=Math.round(1e7*Math.random()),ue},Me=function(){return Math.round(4294967296*Math.random())},_e=function(){var e=null;if(window.XMLHttpRequest)e=new XMLHttpRequest;else try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){return null}}return e},ye=function(e,t,n,o,i,r,s){var u,a,c=_e();if(!c){a="创建请求失败";var u=me.getReturnError(a,-1);return he.error(a),void(s&&s(u))}re++,se[re]=c,c.open(e,t,!0),c.onreadystatechange=function(){4==c.readyState&&(se[re]=null,200==c.status?(r&&r(c.responseText),c=null,x=z=0):(c=null,setTimeout(function(){var e="请求服务器失败,请检查你的网络是否正常",t=me.getReturnError(e,-2);s&&s(t)},16)))},c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o||(o=U),o&&(c.timeout=o,c.ontimeout=function(e){c=null}),c.overrideMimeType&&c.overrideMimeType("application/json"),c.send(n)},Te=function(e,t,n,o,i,r,s){ye(e,t,JSON.stringify(n),o,i,function(e){var t=null;e&&(t=JSON.parse(e)),r&&r(t)},s)},Ce=function(){return oe.sdkAppID&&oe.identifier},Ae=function(e,t){if(!Ce()){if(t){var n="请登录",o=me.getReturnError(n,-4);e&&e(o)}return!1}return!0},Se=function(){return o},ve=function(e,t,o,r){var s=i;s=Se()?i.FORMAL.COMMON:i.TEST.COMMON,e==u.PIC&&(s=Se()?i.FORMAL.PIC:i.TEST.PIC);var c=s+"/"+a[e]+"/"+e+"/"+t+"?websdkappid="+n.APPID+"&v="+n.VERSION+"&platform="+n.PLAATFORM;if(Ce()){if("login"==t)c+="&identifier="+encodeURIComponent(oe.identifier)+"&usersig="+oe.userSig;else if(oe.tinyid&&oe.a2)c+="&tinyid="+oe.tinyid+"&a2="+oe.a2;else if(r)return he.error("tinyid或a2为空["+e+"]["+t+"]"),r(me.getReturnError("tinyid或a2为空["+e+"]["+t+"]",-5)),!1;c+="&contenttype="+oe.contentType}return c+="&sdkappid="+oe.sdkAppID+"&accounttype="+oe.accountType+"&apn="+oe.apn+"&reqtime="+Ie()},Oe=function(e,t){var n=null;return te&&ee[0]?n="http://"+ee[0]+"/asn.com/stddownload_common_file?authkey="+te+"&bid="+E.BUSSINESS_ID+"&subbid="+oe.sdkAppID+"&fileid="+e+"&filetype="+M.SOUND+"&openid="+t+"&ver=0":he.error("拼接语音下载url不报错：ip或者authkey为空"),n},Re=function(e,t,n){var o=null;return te&&ee[0]?o="http://"+ee[0]+"/asn.com/stddownload_common_file?authkey="+te+"&bid="+E.BUSSINESS_ID+"&subbid="+oe.sdkAppID+"&fileid="+e+"&filetype="+M.FILE+"&openid="+t+"&ver=0&filename="+encodeURIComponent(n):he.error("拼接文件下载url不报错：ip或者authkey为空"),ge.downloadMap["uuid_"+e]=o,o},Ge=function(e,t,n,o,i,r,s){var u={From_Account:t,To_Account:i,os_platform:10,Timestamp:Ie().toString(),Random:Me().toString(),request_info:[{busi_id:r,download_flag:o,type:s,uuid:e,version:y.SERVER_VERSION,auth_key:te,ip:ee[0]}]};Lt(u,function(e){0==e.error_code&&e.response_info&&(ge.downloadMap["uuid_"+u.uuid]=e.response_info.url),onAppliedDownloadUrl&&onAppliedDownloadUrl({uuid:u.uuid,url:e.response_info.url,maps:ge.downloadMap})},function(e){he.error("获取下载地址失败",u.uuid)})},Ne=function(){for(var e in se){var t=se[e];t&&(t.abort(),se[re]=null)}re=0,se={}},Fe=function(){Ne(),oe={sdkAppID:null,appIDAt3rd:null,accountType:null,identifier:null,identifierNick:null,userSig:null,contentType:"json",apn:1},ie={},ue=0,Q=0,W=null,pe=[],Bt.clear(),J=null},be=function(e,t,n,i,r){return Fe(),n&&(ie=n),0==ie.isAccessFormalEnv&&(he.error("请切换为正式环境"),o=ie.isAccessFormalEnv),0==ie.isLogOn&&he.setOn(ie.isLogOn),!e&&r?void r(me.getReturnError("loginInfo is empty",-6)):!e.sdkAppID&&r?void r(me.getReturnError("loginInfo.sdkAppID is empty",-7)):!e.accountType&&r?void r(me.getReturnError("loginInfo.accountType is empty",-8)):(e.identifier&&(oe.identifier=e.identifier.toString()),e.identifier&&!e.userSig&&r?void r(me.getReturnError("loginInfo.userSig is empty",-9)):(e.userSig&&(oe.userSig=e.userSig.toString()),oe.sdkAppID=e.sdkAppID,oe.accountType=e.accountType,void(oe.identifier&&oe.userSig?we(function(e,n){Bt.init(t,function(t){i&&(t.identifierNick=e,t.headurl=n,i(t))},r)},r):Bt.init(t,i,r))))},Pe=function(){r=me.getBrowserInfo(),he.info("BROWSER_INFO: type="+r.type+", ver="+r.ver),"ie"==r.type&&parseInt(r.ver)<10&&(s=!0)},Le=function(e,t,o){if("longpolling"!=e||t!=V&&t!=H){var i=c[e];if(i){var r=Ie(),s=null,u={Code:t,ErrMsg:o};if(oe.a2?s=oe.a2.substring(0,10)+"_"+r+"_"+Me():oe.userSig&&(s=oe.userSig.substring(0,10)+"_"+r+"_"+Me()),s){var a={UniqKey:s,EventId:i,ReportTime:r,MsgCmdErrorCode:u};if("login"==e){var l=[];l.push(a);var p={EvtItems:l,MainVersion:n.VERSION,Version:"0"};bt(p,function(e){l=null},function(e){l=null})}else if(pe.push(a),pe.length>=le){var g={EvtItems:pe,MainVersion:n.VERSION,Version:"0"};bt(g,function(e){pe=[]},function(e){pe=[]})}}}}},we=function(e,t){wt.apiCall(u.OPEN_IM,"login",{State:"Online"},function(n){if(n.TinyId)oe.tinyid=n.TinyId;else if(t)return void t(me.getReturnError("TinyId is empty",-10));if(n.A2Key)oe.a2=n.A2Key;else if(t)return void t(me.getReturnError("A2Key is empty",-11));var o=["Tag_Profile_IM_Nick","Tag_Profile_IM_Image"],i={From_Account:oe.identifier,To_Account:[oe.identifier],LastStandardSequence:0,TagList:o};At(i,function(t){var n,o;if(t.UserProfileItem&&t.UserProfileItem.length>0)for(var i in t.UserProfileItem)for(var r in t.UserProfileItem[i].ProfileItem)switch(t.UserProfileItem[i].ProfileItem[r].Tag){case"Tag_Profile_IM_Nick":n=t.UserProfileItem[i].ProfileItem[r].Value,n&&(oe.identifierNick=n);break;case"Tag_Profile_IM_Image":o=t.UserProfileItem[i].ProfileItem[r].Value,o&&(oe.headurl=o)}e&&e(oe.identifierNick,oe.headurl)},t)},t)},Ue=function(e,t,n){return Ae(n,!1)?void("all"==e?wt.apiCall(u.OPEN_IM,"logout",{},function(e){Fe(),t&&t(e)},n):wt.apiCall(u.OPEN_IM,"longpollinglogout",{LongPollingId:J},function(e){Fe(),t&&t(e)},n)):(Fe(),void(t&&t({ActionStatus:f.OK,ErrorCode:0,ErrorInfo:"logout success"})))},De=function(e,t,n){if(Ae(n,!0)){var o=null;switch(e.sess.type()){case l.C2C:o={From_Account:oe.identifier,To_Account:e.sess.id().toString(),MsgTimeStamp:e.time,MsgSeq:e.seq,MsgRandom:e.random,MsgBody:[]};break;case l.GROUP:var i=e.getSubType();switch(o={GroupId:e.sess.id().toString(),From_Account:oe.identifier,Random:e.random,MsgBody:[]},i){case S.COMMON:o.MsgPriority="COMMON";break;case S.REDPACKET:o.MsgPriority="REDPACKET";break;case S.LOVEMSG:o.MsgPriority="LOVEMSG";break;case S.TIP:he.error("不能主动发送群提示消息,subType="+i);break;default:return void he.error("发送群消息时，出现未知子消息类型：subType="+i)}}for(var r in e.elems){var s=e.elems[r],a=null,c=s.type;switch(c){case m.TEXT:a={Text:s.content.text};break;case m.FACE:a={Index:s.content.index,Data:s.content.data};break;case m.IMAGE:var p=[];for(var g in s.content.ImageInfoArray)p.push({Type:s.content.ImageInfoArray[g].type,Size:s.content.ImageInfoArray[g].size,Width:s.content.ImageInfoArray[g].width,Height:s.content.ImageInfoArray[g].height,URL:s.content.ImageInfoArray[g].url});a={UUID:s.content.UUID,ImageInfoArray:p};break;case m.SOUND:he.warn("web端暂不支持发送语音消息");continue;case m.LOCATION:he.warn("web端暂不支持发送地理位置消息");continue;case m.FILE:a={UUID:s.content.uuid,FileName:s.content.name,FileSize:s.content.size,DownloadFlag:s.content.downFlag};break;case m.CUSTOM:a={Data:s.content.data,Desc:s.content.desc,Ext:s.content.ext},c=m.CUSTOM;break;default:he.warn("web端暂不支持发送"+s.type+"消息");continue}e.PushInfoBoolean&&(o.OfflinePushInfo=e.PushInfo),o.MsgBody.push({MsgType:c,MsgContent:a})}e.sess.type()==l.C2C?wt.apiCall(u.OPEN_IM,"sendmsg",o,t,n):e.sess.type()==l.GROUP&&wt.apiCall(u.GROUP,"send_group_msg",o,t,n)}},ke=function(e,t,n){(o||"undefined"==typeof stopPolling||1!=stopPolling)&&Ae(n,!0)&&wt.apiCall(u.OPEN_IM,"longpolling",e,t,n,B,!0)},qe=function(e,t,n,o){wt.apiCall(u.BIG_GROUP_LONG_POLLING,"get_msg",e,t,n,o)},xe=function(e,t,n,o){Ae(o,!0)&&wt.apiCall(u.OPEN_IM,"getmsg",{Cookie:e,SyncFlag:t},function(e){if(e.MsgList&&e.MsgList.length)for(var t in e.MsgList)ae.push(e.MsgList[t]);1==e.SyncFlag?xe(e.Cookie,e.SyncFlag,n,o):(e.MsgList=ae,ae=[],n&&n(e))},o)},Be=function(e,t,n,o){if(Ae(o,!0)){var i=[];for(var r in t){var s={To_Account:t[r].toAccount,LastedMsgTime:t[r].lastedMsgTime};i.push(s)}wt.apiCall(u.OPEN_IM,"msgreaded",{C2CMsgReaded:{Cookie:e,C2CMsgReadedItem:i}},n,o)}},Ke=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.OPEN_IM,"deletemsg",e,t,n)},Ve=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.OPEN_IM,"getroammsg",e,function(o){var i=e.MaxCnt,r=o.Complete,s=o.MaxCnt,u=o.MsgKey,a=o.LastMsgTime;if(o.MsgList&&o.MsgList.length)for(var c in o.MsgList)ce.push(o.MsgList[c]);var l=null;0==r&&s<i&&(l={Peer_Account:e.Peer_Account,MaxCnt:i-s,LastMsgTime:a,MsgKey:u}),l?Ve(l,t,n):(o.MsgList=ce,ce=[],t&&t(o))},n)},He=function(e,t,n){if(Ae(n,!0)){for(var o={Type:e.Type,Name:e.Name},i=[],r=0;r<e.MemberList.length;r++)i.push({Member_Account:e.MemberList[r]});o.MemberList=i,e.GroupId&&(o.GroupId=e.GroupId),e.Owner_Account&&(o.Owner_Account=e.Owner_Account),e.Introduction&&(o.Introduction=e.Introduction),e.Notification&&(o.Notification=e.Notification),e.MaxMemberCount&&(o.MaxMemberCount=e.MaxMemberCount),e.ApplyJoinOption&&(o.ApplyJoinOption=e.ApplyJoinOption),e.AppDefinedData&&(o.AppDefinedData=e.AppDefinedData),e.FaceUrl&&(o.FaceUrl=e.FaceUrl),wt.apiCall(u.GROUP,"create_group",o,t,n)}},Je=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.GROUP,"create_group",e,t,n)},ze=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.GROUP,"modify_group_base_info",e,t,n)},Ye=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.GROUP,"apply_join_group",{GroupId:e.GroupId,ApplyMsg:e.ApplyMsg,UserDefinedField:e.UserDefinedField},t,n)},Xe=function(e,n,o){t=e.GroupId;var i;i=Ae(o,!1)?u.GROUP:u.BIG_GROUP,wt.apiCall(i,"apply_join_group",{GroupId:e.GroupId,ApplyMsg:e.ApplyMsg,UserDefinedField:e.UserDefinedField},function(t){if(t.JoinedStatus&&"JoinedSuccess"==t.JoinedStatus){if(!t.LongPollingKey)return void(o&&o(me.getReturnError("Join Group succeed; But the type of group is not AVChatRoom: groupid="+e.GroupId,-12)));Bt.setBigGroupLongPollingOn(!0),Bt.setBigGroupLongPollingKey(t.LongPollingKey),Bt.setBigGroupLongPollingMsgMap(e.GroupId,0),Bt.bigGroupLongPolling()}n&&n(t)},function(e){o&&o(e)})},je=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.GROUP,"handle_apply_join_group",{GroupId:e.GroupId,Applicant_Account:e.Applicant_Account,HandleMsg:e.HandleMsg,Authentication:e.Authentication,MsgKey:e.MsgKey,ApprovalMsg:e.ApprovalMsg,UserDefinedField:e.UserDefinedField},t,function(e){if(10024==e.ErrorCode){if(t){var o={ActionStatus:f.OK,ErrorCode:0,ErrorInfo:"该申请已经被处理过"};t(o)}}else n&&n(e)})},Qe=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.GROUP,"get_pendency",{StartTime:e.StartTime,Limit:e.Limit,Handle_Account:oe.identifier},t,function(e){})},We=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.GROUP,"report_pendency",{ReportTime:e.ReportTime,From_Account:oe.identifier},t,function(e){})},Ze=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.GROUP,"handle_invite_join_group",{GroupId:e.GroupId,Inviter_Account:e.Inviter_Account,HandleMsg:e.HandleMsg,Authentication:e.Authentication,MsgKey:e.MsgKey,ApprovalMsg:e.ApprovalMsg,UserDefinedField:e.UserDefinedField},t,function(e){})},$e=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.GROUP,"quit_group",{GroupId:e.GroupId},t,n)},et=function(e,t,n){var o;o=Ae(n,!1)?u.GROUP:u.BIG_GROUP,wt.apiCall(o,"quit_group",{GroupId:e.GroupId},function(e){Bt.resetBigGroupLongPollingInfo(),t&&t(e)},n)},tt=function(e,t,n){wt.apiCall(u.GROUP,"search_group",e,t,n)},nt=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.GROUP,"get_group_public_info",{GroupIdList:e.GroupIdList,ResponseFilter:{GroupBasePublicInfoFilter:e.GroupBasePublicInfoFilter}},function(e){if(e.ErrorInfo="",e.GroupInfo)for(var o in e.GroupInfo){var i=e.GroupInfo[o].ErrorCode;i>0&&(e.ActionStatus=f.FAIL,e.GroupInfo[o].ErrorInfo="["+i+"]"+e.GroupInfo[o].ErrorInfo,e.ErrorInfo+=e.GroupInfo[o].ErrorInfo+"\n")}e.ActionStatus==f.FAIL?n&&n(e):t&&t(e)},n)},ot=function(e,t,n){if(Ae(n,!0)){var o={GroupIdList:e.GroupIdList,ResponseFilter:{GroupBaseInfoFilter:e.GroupBaseInfoFilter,MemberInfoFilter:e.MemberInfoFilter}};e.AppDefinedDataFilter_Group&&(o.ResponseFilter.AppDefinedDataFilter_Group=e.AppDefinedDataFilter_Group),e.AppDefinedDataFilter_GroupMember&&(o.ResponseFilter.AppDefinedDataFilter_GroupMember=e.AppDefinedDataFilter_GroupMember),wt.apiCall(u.GROUP,"get_group_info",o,t,n)}},it=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.GROUP,"get_group_member_info",{GroupId:e.GroupId,Offset:e.Offset,Limit:e.Limit,MemberInfoFilter:e.MemberInfoFilter,MemberRoleFilter:e.MemberRoleFilter,AppDefinedDataFilter_GroupMember:e.AppDefinedDataFilter_GroupMember},t,n)},rt=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.GROUP,"add_group_member",{GroupId:e.GroupId,Silence:e.Silence,MemberList:e.MemberList},t,n)},st=function(e,t,n){if(Ae(n,!0)){var o={};e.GroupId&&(o.GroupId=e.GroupId),e.Member_Account&&(o.Member_Account=e.Member_Account),e.Role&&(o.Role=e.Role),e.MsgFlag&&(o.MsgFlag=e.MsgFlag),e.ShutUpTime&&(o.ShutUpTime=e.ShutUpTime),e.NameCard&&(o.NameCard=e.NameCard),e.AppMemberDefinedData&&(o.AppMemberDefinedData=e.AppMemberDefinedData),wt.apiCall(u.GROUP,"modify_group_member_info",o,t,n)}},ut=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.GROUP,"delete_group_member",{GroupId:e.GroupId,Silence:e.Silence,MemberToDel_Account:e.MemberToDel_Account,Reason:e.Reason},t,n)},at=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.GROUP,"destroy_group",{GroupId:e.GroupId},t,n)},ct=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.GROUP,"change_group_owner",e,t,n)},lt=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.GROUP,"get_joined_group_list",{Member_Account:e.Member_Account,Limit:e.Limit,Offset:e.Offset,GroupType:e.GroupType,ResponseFilter:{GroupBaseInfoFilter:e.GroupBaseInfoFilter,SelfInfoFilter:e.SelfInfoFilter}},t,n)},pt=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.GROUP,"get_role_in_group",{GroupId:e.GroupId,User_Account:e.User_Account},t,n)},gt=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.GROUP,"forbid_send_msg",{GroupId:e.GroupId,Members_Account:e.Members_Account,ShutUpTime:e.ShutUpTime},t,n)},ft=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.GROUP,"send_group_system_notification",e,t,n)},dt=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.GROUP,"group_msg_get",{GroupId:e.GroupId,ReqMsgSeq:e.ReqMsgSeq,ReqMsgNumber:e.ReqMsgNumber},t,n)},mt=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.GROUP,"msg_read_report",{GroupId:e.GroupId,MsgReadedSeq:e.MsgReadedSeq},t,n)},ht=function(e){var t=[];if(e.Fail_Account&&e.Fail_Account.length&&(t=e.Fail_Account),e.Invalid_Account&&e.Invalid_Account.length)for(var n in e.Invalid_Account)t.push(e.Invalid_Account[n]);if(t.length){e.ActionStatus=f.FAIL,e.ErrorCode=d,e.ErrorInfo="";for(var o in t){var i=t[o];for(var r in e.ResultItem)if(e.ResultItem[r].To_Account==i){var s=e.ResultItem[r].ResultCode;e.ResultItem[r].ResultInfo="["+s+"]"+e.ResultItem[r].ResultInfo,e.ErrorInfo+=e.ResultItem[r].ResultInfo+"\n";break}}}return e},It=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.FRIEND,"friend_add",{From_Account:oe.identifier,AddFriendItem:e.AddFriendItem},function(e){var o=ht(e);o.ActionStatus==f.FAIL?n&&n(o):t&&t(o)},n)},Et=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.FRIEND,"friend_delete",{From_Account:oe.identifier,To_Account:e.To_Account,DeleteType:e.DeleteType},function(e){var o=ht(e);o.ActionStatus==f.FAIL?n&&n(o):t&&t(o)},n)},Mt=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.FRIEND,"pendency_get",{From_Account:oe.identifier,PendencyType:e.PendencyType,StartTime:e.StartTime,MaxLimited:e.MaxLimited,LastSequence:e.LastSequence},t,n)},_t=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.FRIEND,"PendencyReport",{From_Account:oe.identifier,LatestPendencyTimeStamp:e.LatestPendencyTimeStamp},t,n)},yt=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.FRIEND,"pendency_delete",{From_Account:oe.identifier,PendencyType:e.PendencyType,To_Account:e.To_Account},function(e){var o=ht(e);o.ActionStatus==f.FAIL?n&&n(o):t&&t(o)},n)},Tt=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.FRIEND,"friend_response",{From_Account:oe.identifier,ResponseFriendItem:e.ResponseFriendItem},function(e){var o=ht(e);o.ActionStatus==f.FAIL?n&&n(o):t&&t(o)},n)},Ct=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.FRIEND,"friend_get_all",{From_Account:oe.identifier,TimeStamp:e.TimeStamp,StartIndex:e.StartIndex,GetCount:e.GetCount,LastStandardSequence:e.LastStandardSequence,TagList:e.TagList},t,n)},At=function(e,t,n){e.To_Account.length>100&&(e.To_Account.length=100,he.error("获取用户资料人数不能超过100人")),Ae(n,!0)&&wt.apiCall(u.PROFILE,"portrait_get",{From_Account:oe.identifier,To_Account:e.To_Account,TagList:e.TagList},function(e){var o=[];if(e.Fail_Account&&e.Fail_Account.length&&(o=e.Fail_Account),e.Invalid_Account&&e.Invalid_Account.length)for(var i in e.Invalid_Account)o.push(e.Invalid_Account[i]);if(o.length){e.ActionStatus=f.FAIL,e.ErrorCode=d,e.ErrorInfo="";for(var r in o){var s=o[r];for(var u in e.UserProfileItem)if(e.UserProfileItem[u].To_Account==s){
var a=e.UserProfileItem[u].ResultCode;e.UserProfileItem[u].ResultInfo="["+a+"]"+e.UserProfileItem[u].ResultInfo,e.ErrorInfo+="账号:"+s+","+e.UserProfileItem[u].ResultInfo+"\n";break}}}e.ActionStatus==f.FAIL?n&&n(e):t&&t(e)},n)},St=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.PROFILE,"portrait_set",{From_Account:oe.identifier,ProfileItem:e.ProfileItem},function(n){for(var o in e.ProfileItem){var i=e.ProfileItem[o];if("Tag_Profile_IM_Nick"==i.Tag){oe.identifierNick=i.Value;break}}t&&t(n)},n)},vt=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.FRIEND,"black_list_add",{From_Account:oe.identifier,To_Account:e.To_Account},function(e){var o=ht(e);o.ActionStatus==f.FAIL?n&&n(o):t&&t(o)},n)},Ot=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.FRIEND,"black_list_delete",{From_Account:oe.identifier,To_Account:e.To_Account},function(e){var o=ht(e);o.ActionStatus==f.FAIL?n&&n(o):t&&t(o)},n)},Rt=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.FRIEND,"black_list_get",{From_Account:oe.identifier,StartIndex:e.StartIndex,MaxLimited:e.MaxLimited,LastSequence:e.LastSequence},t,n)},Gt=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.RECENT_CONTACT,"get",{From_Account:oe.identifier,Count:e.Count},t,n)},Nt=function(e,t,n){if(Ae(n,!0)){var o;o=Se()?"pic_up":"pic_up_test",wt.apiCall(u.PIC,o,{App_Version:y.APP_VERSION,From_Account:oe.identifier,To_Account:e.To_Account,Seq:e.Seq,Timestamp:e.Timestamp,Random:e.Random,File_Str_Md5:e.File_Str_Md5,File_Size:e.File_Size,File_Type:e.File_Type,Server_Ver:y.SERVER_VERSION,Auth_Key:te,Busi_Id:e.Busi_Id,PkgFlag:e.PkgFlag,Slice_Offset:e.Slice_Offset,Slice_Size:e.Slice_Size,Slice_Data:e.Slice_Data},t,n)}},Ft=function(e,t){Ae(t,!0)&&wt.apiCall(u.OPEN_IM,"authkey",{},e,t)},bt=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.IM_OPEN_STAT,"web_report",e,t,n)},Pt=function(e,t,n){Ae(n,!0)&&wt.apiCall(u.OPEN_IM,"getlongpollingid",{},function(e){t&&t(e)},n)},Lt=function(e,t,n){wt.apiCall(u.PIC,"apply_download",e,t,n)};Pe();var wt=0==s?new function(){var e=null;this.init=function(t,n,o){t&&(e=t)},this.callBack=function(t){e&&e(t)},this.clear=function(){e=null},this.apiCall=function(e,t,n,o,i,r,s){var u=ve(e,t,o,i);0!=u&&Te("POST",u,n,r,s,function(r){var s=null,a="";"pic_up"==t&&(n.Slice_Data="");var c="\n request url: \n"+u+"\n request body: \n"+JSON.stringify(n)+"\n response: \n"+JSON.stringify(r);r.ActionStatus==f.OK?(he.info("["+e+"]["+t+"]success: "+c),o&&o(r),s=0,a=""):(s=r.ErrorCode,a=r.ErrorInfo,i&&(r.SrcErrorInfo=r.ErrorInfo,r.ErrorInfo="["+e+"]["+t+"]failed: "+c,"longpolling"==t&&r.ErrorCode==V||he.error(r.ErrorInfo),i(r))),Le(t,s,a)},function(e){i&&i(e),Le(t,e.ErrorCode,e.ErrorInfo)})}}:new function(){var e=null;this.init=function(t,n,o){t&&(e=t)},this.callBack=function(t){e&&e(t)},this.clear=function(){e=null},this.apiCall=function(e,t,n,o,i,r,s){var u=ve(e,t,o,i);if(0!=u){var a=Q++,c="jsonpcallback",l="jsonpRequest"+a,p=document.createElement("script"),g=0;window[l]=Z,p.type="text/javascript",u=u+"&"+c+"="+l+"&jsonpbody="+encodeURIComponent(JSON.stringify(n)),p.src=u,p.async=!0,"undefined"!=typeof p.onreadystatechange&&(p.event="onclick",p.htmlFor=p.id="_jsonpRequest_"+a),p.onload=p.onreadystatechange=function(){if(this.readyState&&"complete"!==this.readyState&&"loaded"!==this.readyState||g)return!1;p.onload=p.onreadystatechange=null,p.onclick&&p.onclick();var r=W,s="\n request url: \n"+u+"\n request body: \n"+JSON.stringify(n)+"\n response: \n"+JSON.stringify(r);r.ActionStatus==f.OK?(he.info("["+e+"]["+t+"]success: "+s),o&&o(r)):(r.ErrorInfo="["+e+"]["+t+"]failed "+s,"longpolling"!=t||r.ErrorCode!=V?he.error(r.ErrorInfo):he.warn("["+e+"]["+t+"]success: "+s),i&&i(r)),W=void 0,document.body.removeChild(p),g=1},document.body.appendChild(p)}}},Ut=function(e,t,n,o,i,r){this._impl={skey:Ut.skey(e,t),type:e,id:t,name:n,icon:o,unread:0,isAutoRead:!1,time:i>=0?i:0,curMaxMsgSeq:r>=0?r:0,msgs:[],isFinished:1}};Ut.skey=function(e,t){return e+t},Ut.prototype.type=function(){return this._impl.type},Ut.prototype.id=function(){return this._impl.id},Ut.prototype.name=function(){return this._impl.name},Ut.prototype.icon=function(){return this._impl.icon},Ut.prototype.unread=function(e){return"undefined"==typeof e?this._impl.unread:void(this._impl.unread=e)},Ut.prototype.isFinished=function(e){return"undefined"==typeof e?this._impl.isFinished:void(this._impl.isFinished=e)},Ut.prototype.time=function(){return this._impl.time},Ut.prototype.curMaxMsgSeq=function(e){return"undefined"==typeof e?this._impl.curMaxMsgSeq:void(this._impl.curMaxMsgSeq=e)},Ut.prototype.msgCount=function(){return this._impl.msgs.length},Ut.prototype.msg=function(e){return this._impl.msgs[e]},Ut.prototype.msgs=function(){return this._impl.msgs},Ut.prototype._impl_addMsg=function(e){this._impl.msgs.push(e),e.time>this._impl.time&&(this._impl.time=e.time),e.seq>this._impl.curMaxMsgSeq&&(this._impl.curMaxMsgSeq=e.seq),e.isSend||this._impl.isAutoRead||this._impl.unread++};var Dt=function(e,t){this.toAccount=e,this.lastedMsgTime=t},kt=function(e,t){for(var n=parseInt(e).toString(2)+"00000000000000000000000000000000",o=parseInt(t).toString(2),i=n.split("").reverse(),r=o.split("").reverse(),s=[],u=i.length>r.length?i.length:r.length,a=0;a<u;a++)sig=Number(i[a]||0)||Number(r[a]||0),s.push(sig);var c=s.reverse().join(""),l={high:"0x"+parseInt(c.substr(0,c.length-32),2).toString(16),low:"0x"+parseInt(c.substr(c.length-32-1),2).toString(16)},p=new Long(l.low,l.high,!0);return p.toString()},qt=function(e,t,n,o,i,r,s,u){this.sess=e,this.subType=s>=0?s:0,this.fromAccount=r,this.fromAccountNick=u?u:r,this.isSend=Boolean(t),this.seq=n>=0?n:Ee(),this.random=o>=0?o:Me(),this.time=i>=0?i:Ie(),this.elems=[];var a=e.type();switch(a){case l.GROUP:this.uniqueId=kt(this.seq,this.random);break;case l.C2C:default:this.uniqueId=kt(this.time,this.random)}};qt.prototype.getSession=function(){return this.sess},qt.prototype.getType=function(){return this.subType},qt.prototype.getSubType=function(){return this.subType},qt.prototype.getFromAccount=function(){return this.fromAccount},qt.prototype.getFromAccountNick=function(){return this.fromAccountNick},qt.prototype.getIsSend=function(){return this.isSend},qt.prototype.getSeq=function(){return this.seq},qt.prototype.getTime=function(){return this.time},qt.prototype.getRandom=function(){return this.random},qt.prototype.getElems=function(){return this.elems},qt.prototype.getMsgUniqueId=function(){return this.uniqueId},qt.prototype.addText=function(t){this.addElem(new e.Msg.Elem(m.TEXT,t))},qt.prototype.addFace=function(t){this.addElem(new e.Msg.Elem(m.FACE,t))},qt.prototype.addImage=function(t){this.addElem(new e.Msg.Elem(m.IMAGE,t))},qt.prototype.addLocation=function(t){this.addElem(new e.Msg.Elem(m.LOCATION,t))},qt.prototype.addFile=function(t){this.addElem(new e.Msg.Elem(m.FILE,t))},qt.prototype.addCustom=function(t){this.addElem(new e.Msg.Elem(m.CUSTOM,t))},qt.prototype.addElem=function(e){this.elems.push(e)},qt.prototype.toHtml=function(){var e="";for(var t in this.elems){var n=this.elems[t];e+=n.toHtml()}return e},qt.Elem=function(e,t){this.type=e,this.content=t},qt.Elem.prototype.getType=function(){return this.type},qt.Elem.prototype.getContent=function(){return this.content},qt.Elem.prototype.toHtml=function(){var e;return e=this.content.toHtml()},qt.Elem.Text=function(e){this.text=me.xssFilter(e)},qt.Elem.Text.prototype.getText=function(){return this.text},qt.Elem.Text.prototype.toHtml=function(){return this.text},qt.Elem.Face=function(e,t){this.index=e,this.data=t},qt.Elem.Face.prototype.getIndex=function(){return this.index},qt.Elem.Face.prototype.getData=function(){return this.data},qt.Elem.Face.prototype.toHtml=function(){var e=null,t=fe[this.data],n=de[t];return n&&n[1]&&(e=n[1]),e?"<img src='"+e+"'/>":this.data},qt.Elem.Location=function(e,t,n){this.latitude=t,this.longitude=e,this.desc=n},qt.Elem.Location.prototype.getLatitude=function(){return this.latitude},qt.Elem.Location.prototype.getLongitude=function(){return this.longitude},qt.Elem.Location.prototype.getDesc=function(){return this.desc},qt.Elem.Location.prototype.toHtml=function(){return"经度="+this.longitude+",纬度="+this.latitude+",描述="+this.desc},qt.Elem.Images=function(e){this.UUID=e,this.ImageInfoArray=[]},qt.Elem.Images.prototype.addImage=function(e){this.ImageInfoArray.push(e)},qt.Elem.Images.prototype.toHtml=function(){var e=this.getImage(h.SMALL),t=this.getImage(h.LARGE),n=this.getImage(h.ORIGIN);return t||(t=e),n||(n=e),"<img src='"+e.getUrl()+"#"+t.getUrl()+"#"+n.getUrl()+"' style='CURSOR: hand' id='"+this.getImageId()+"' bigImgUrl='"+t.getUrl()+"' onclick='imageClick(this)' />"},qt.Elem.Images.prototype.getImageId=function(){return this.UUID},qt.Elem.Images.prototype.getImage=function(e){for(var t in this.ImageInfoArray)if(this.ImageInfoArray[t].getType()==e)return this.ImageInfoArray[t];return null},qt.Elem.Images.Image=function(e,t,n,o,i){this.type=e,this.size=t,this.width=n,this.height=o,this.url=i},qt.Elem.Images.Image.prototype.getType=function(){return this.type},qt.Elem.Images.Image.prototype.getSize=function(){return this.size},qt.Elem.Images.Image.prototype.getWidth=function(){return this.width},qt.Elem.Images.Image.prototype.getHeight=function(){return this.height},qt.Elem.Images.Image.prototype.getUrl=function(){return this.url},qt.Elem.Sound=function(e,t,n,o,i,r,s){this.uuid=e,this.second=t,this.size=n,this.senderId=o,this.receiverId=i,this.downFlag=r,this.busiId=s==l.C2C?2:1,void 0!==r&&void 0!==busiId?Ge(e,o,t,r,i,this.busiId,_.SOUND):this.downUrl=Oe(e,o,t)},qt.Elem.Sound.prototype.getUUID=function(){return this.uuid},qt.Elem.Sound.prototype.getSecond=function(){return this.second},qt.Elem.Sound.prototype.getSize=function(){return this.size},qt.Elem.Sound.prototype.getSenderId=function(){return this.senderId},qt.Elem.Sound.prototype.getDownUrl=function(){return this.downUrl},qt.Elem.Sound.prototype.toHtml=function(){return"ie"==r.type&&parseInt(r.ver)<=8?"[这是一条语音消息]demo暂不支持ie8(含)以下浏览器播放语音,语音URL:"+this.downUrl:'<audio id="uuid_'+this.uuid+'" src="'+this.downUrl+'" controls="controls" onplay="onChangePlayAudio(this)" preload="none"></audio>'},qt.Elem.File=function(e,t,n,o,i,r,s){this.uuid=e,this.name=t,this.size=n,this.senderId=o,this.receiverId=i,this.downFlag=r,this.busiId=s==l.C2C?2:1,void 0!==r&&void 0!==busiId?Ge(e,o,t,r,i,this.busiId,_.FILE):this.downUrl=Re(e,o,t)},qt.Elem.File.prototype.getUUID=function(){return this.uuid},qt.Elem.File.prototype.getName=function(){return this.name},qt.Elem.File.prototype.getSize=function(){return this.size},qt.Elem.File.prototype.getSenderId=function(){return this.senderId},qt.Elem.File.prototype.getDownUrl=function(){return this.downUrl},qt.Elem.File.prototype.getDownFlag=function(){return this.downFlag},qt.Elem.File.prototype.toHtml=function(){var e,t;return e=this.size,t="Byte",this.size>=1024&&(e=Math.round(this.size/1024),t="KB"),'<a href="javascript" onclick="webim.onDownFile("'+this.uuid+'")" title="点击下载文件" ><i class="glyphicon glyphicon-file">&nbsp;'+this.name+"("+e+t+")</i></a>"},qt.Elem.GroupTip=function(e,t,n,o,i,r){this.opType=e,this.opUserId=t,this.groupId=n,this.groupName=o,this.userIdList=i?i:[],this.groupInfoList=[],this.memberInfoList=[],this.groupMemberNum=null,this.userinfo=r?r:[]},qt.Elem.GroupTip.prototype.addGroupInfo=function(e){this.groupInfoList.push(e)},qt.Elem.GroupTip.prototype.addMemberInfo=function(e){this.memberInfoList.push(e)},qt.Elem.GroupTip.prototype.getOpType=function(){return this.opType},qt.Elem.GroupTip.prototype.getOpUserId=function(){return this.opUserId},qt.Elem.GroupTip.prototype.getGroupId=function(){return this.groupId},qt.Elem.GroupTip.prototype.getGroupName=function(){return this.groupName},qt.Elem.GroupTip.prototype.getUserIdList=function(){return this.userIdList},qt.Elem.GroupTip.prototype.getUserInfo=function(){return this.userinfo},qt.Elem.GroupTip.prototype.getGroupInfoList=function(){return this.groupInfoList},qt.Elem.GroupTip.prototype.getMemberInfoList=function(){return this.memberInfoList},qt.Elem.GroupTip.prototype.getGroupMemberNum=function(){return this.groupMemberNum},qt.Elem.GroupTip.prototype.setGroupMemberNum=function(e){return this.groupMemberNum=e},qt.Elem.GroupTip.prototype.toHtml=function(){var e="[群提示消息]",t=D-1;switch(this.opType){case O.JOIN:e+=this.opUserId+"邀请了";for(var n in this.userIdList)if(e+=this.userIdList[n]+",",this.userIdList.length>D&&n==t){e+="等"+this.userIdList.length+"人";break}e+="加入该群";break;case O.QUIT:e+=this.opUserId+"主动退出该群";break;case O.KICK:e+=this.opUserId+"将";for(var n in this.userIdList)if(e+=this.userIdList[n]+",",this.userIdList.length>D&&n==t){e+="等"+this.userIdList.length+"人";break}e+="踢出该群";break;case O.SET_ADMIN:e+=this.opUserId+"将";for(var n in this.userIdList)if(e+=this.userIdList[n]+",",this.userIdList.length>D&&n==t){e+="等"+this.userIdList.length+"人";break}e+="设为管理员";break;case O.CANCEL_ADMIN:e+=this.opUserId+"取消";for(var n in this.userIdList)if(e+=this.userIdList[n]+",",this.userIdList.length>D&&n==t){e+="等"+this.userIdList.length+"人";break}e+="的管理员资格";break;case O.MODIFY_GROUP_INFO:e+=this.opUserId+"修改了群资料：";for(var n in this.groupInfoList){var o=this.groupInfoList[n].getType(),i=this.groupInfoList[n].getValue();switch(o){case R.FACE_URL:e+="群头像为"+i+"; ";break;case R.NAME:e+="群名称为"+i+"; ";break;case R.OWNER:e+="群主为"+i+"; ";break;case R.NOTIFICATION:e+="群公告为"+i+"; ";break;case R.INTRODUCTION:e+="群简介为"+i+"; ";break;default:e+="未知信息为:type="+o+",value="+i+"; "}}break;case O.MODIFY_MEMBER_INFO:e+=this.opUserId+"修改了群成员资料:";for(var n in this.memberInfoList){var r=this.memberInfoList[n].getUserId(),s=this.memberInfoList[n].getShutupTime();if(e+=r+": ",e+=null!=s&&void 0!==s?0==s?"取消禁言; ":"禁言"+s+"秒; ":" shutupTime为空",this.memberInfoList.length>D&&n==t){e+="等"+this.memberInfoList.length+"人";break}}break;case O.READED:Log.info("消息已读同步");break;default:e+="未知群提示消息类型：type="+this.opType}return e},qt.Elem.GroupTip.GroupInfo=function(e,t){this.type=e,this.value=t},qt.Elem.GroupTip.GroupInfo.prototype.getType=function(){return this.type},qt.Elem.GroupTip.GroupInfo.prototype.getValue=function(){return this.value},qt.Elem.GroupTip.MemberInfo=function(e,t){this.userId=e,this.shutupTime=t},qt.Elem.GroupTip.MemberInfo.prototype.getUserId=function(){return this.userId},qt.Elem.GroupTip.MemberInfo.prototype.getShutupTime=function(){return this.shutupTime},qt.Elem.Custom=function(e,t,n){this.data=e,this.desc=t,this.ext=n},qt.Elem.Custom.prototype.getData=function(){return this.data},qt.Elem.Custom.prototype.getDesc=function(){return this.desc},qt.Elem.Custom.prototype.getExt=function(){return this.ext},qt.Elem.Custom.prototype.toHtml=function(){return this.data};var xt=new function(){var e={},t=[];window.msgCache={},this.cookie="",this.syncFlag=0;var n=function(t){for(var n in e)t(e[n])},o=function(e){var t=!1,n=e.sess._impl.skey,o=e.isSend+e.seq+e.random,i=msgCache[n]&&msgCache[n][o];return i&&(t=!0),msgCache[n]?msgCache[n][o]={time:e.time}:(msgCache[n]={},msgCache[n][o]={time:e.time}),t};this.sessMap=function(){return e},this.sessCount=function(){return t.length},this.sessByTypeId=function(t,n){var o=Ut.skey(t,n);return void 0===o||null==o?null:e[o]},this.delSessByTypeId=function(t,n){var o=Ut.skey(t,n);return void 0!==o&&null!=o&&(e[o]&&(delete e[o],delete msgCache[o]),!0)},this.resetCookieAndSyncFlag=function(){this.cookie="",this.syncFlag=0},this.setAutoRead=function(e,t,o){if(o&&n(function(e){e._impl.isAutoRead=!1}),e&&(e._impl.isAutoRead=t,t))if(e._impl.unread=0,e._impl.type==l.C2C){var i=[];i.push(new Dt(e._impl.id,e._impl.time)),Be(xt.cookie,i,function(e){he.info("[setAutoRead]: c2CMsgReaded success")},function(e){he.error("[setAutoRead}: c2CMsgReaded failed:"+e.ErrorInfo)})}else if(e._impl.type==l.GROUP){var r={GroupId:e._impl.id,MsgReadedSeq:e._impl.curMaxMsgSeq};mt(r,function(e){he.info("groupMsgReaded success")},function(e){he.error("groupMsgReaded failed:"+e.ErrorInfo)})}},this.c2CMsgReaded=function(e,t,n){var o=[];o.push(new Dt(e.To_Account,e.LastedMsgTime)),Be(xt.cookie,o,function(e){t&&(he.info("c2CMsgReaded success"),t(e))},function(e){n&&(he.error("c2CMsgReaded failed:"+e.ErrorInfo),n(e))})},this.addSession=function(t){e[t._impl.skey]=t},this.delSession=function(t){delete e[t._impl.skey]},this.addMsg=function(t){if(o(t))return!1;var n=t.sess;return e[n._impl.skey]||this.addSession(n),n._impl_addMsg(t),!0},this.updateTimeline=function(){var e=new Array;n(function(t){e.push(t)}),e.sort(function(e,t){return t.time-e.time}),t=e}},Bt=new function(){var e=null,n=null,o={1:null,2:null,3:null,4:null,5:null,6:null,7:null,8:null,9:null,10:null,11:null,15:null,255:null,12:null},i={1:null,2:null,3:null,4:null,5:null,6:null,7:null,8:null},r={1:null},s=null,u=!1,a=0,c=0,p=null,g=!1,d=0,h=90,I=null,E={},M=0,_={},y={};this.setLongPollingOn=function(e){u=e},this.getLongPollingOn=function(){return u},this.resetLongPollingInfo=function(){u=!1,a=0,c=0},this.setBigGroupLongPollingOn=function(e){g=e},this.setBigGroupLongPollingKey=function(e){I=e},this.resetBigGroupLongPollingInfo=function(){g=!1,d=0,I=null,E={}},this.setBigGroupLongPollingMsgMap=function(e,t){var n=E[e];n?(n=parseInt(n)+t,E[e]=n):E[e]=t},this.clear=function(){n=null,o={1:null,2:null,3:null,4:null,5:null,6:null,7:null,8:null,9:null,10:null,11:null,15:null,255:null,12:null},i={1:null,2:null,3:null,4:null,5:null,6:null,7:null,8:null},r={1:null},e=null,u=!1,a=0,c=0,p=null,g=!1,d=0,I=null,E={},y={},ee=[],te=null,ne=null};var C=function(e,t){Ft(function(t){ee=t.IpList,te=t.AuthKey,ne=t.ExpireTime,e&&e(t)},function(e){he.error("initIpAndAuthkey failed:"+e.ErrorInfo),t&&t(e)})},b=function(e,t){var n={Member_Account:oe.identifier,Limit:1e3,Offset:0,GroupBaseInfoFilter:["NextMsgSeq"]};lt(n,function(t){if(!t.GroupIdList||0==t.GroupIdList.length)return he.info("initMyGroupMaxSeqs: 目前还没有加入任何群组"),void(e&&e(t));for(var n=0;n<t.GroupIdList.length;n++){var o=t.GroupIdList[n].GroupId,i=t.GroupIdList[n].NextMsgSeq-1;_[o]=i}e&&e(t)},function(e){he.error("initMyGroupMaxSeqs failed:"+e.ErrorInfo),t&&t(e)})},L=function(e,t,n){M++;var o={GroupId:e,ReqMsgSeq:t,ReqMsgNumber:n};he.warn("第"+M+"次补齐群消息,参数="+JSON.stringify(o)),Bt.syncGroupMsgs(o)},U=function(e,t){var n=_[e];n?t>n&&(_[e]=t):_[e]=t},D=function(e,t){for(var n in e){var o=e[n];if(o.From_Account){var i=ce(o,!1,!0);i&&t.push(i),U(o.ToGroupId,o.MsgSeq)}}return t},X=function(t,n){var o={},i=[],r=99999999,s=-1;for(var u in n){var a=o[n[u].ToGroupId];a||(a=o[n[u].ToGroupId]={min:r,max:s,msgs:[]}),n[u].NoticeSeq>c&&(he.warn("noticeSeq="+c+",msgNoticeSeq="+n[u].NoticeSeq),c=n[u].NoticeSeq),n[u].Event=t,o[n[u].ToGroupId].msgs.push(n[u]),n[u].MsgSeq<a.min&&(o[n[u].ToGroupId].min=n[u].MsgSeq),n[u].MsgSeq>a.max&&(o[n[u].ToGroupId].max=n[u].MsgSeq)}for(var l in o){var p=o[l].max-o[l].min+1,g=_[l];g?o[l].min-g>1||o[l].msgs.length<p?(he.warn("发起一次补齐群消息请求,curMaxMsgSeq="+g+", minMsgSeq="+o[l].min+", maxMsgSeq="+o[l].max+", msgs.length="+o[l].msgs.length+", tempCount="+p),L(l,o[l].max,o[l].max-g),U(l,o[l].max)):i=D(o[l].msgs,i):(he.warn("不存在该群的最大消息seq，群id="+l),o[l].msgs.length<p?(he.warn("发起一次补齐群消息请求,minMsgSeq="+o[l].min+", maxMsgSeq="+o[l].max+", msgs.length="+o[l].msgs.length+", tempCount="+p),L(l,o[l].max,p),U(l,o[l].max)):i=D(o[l].msgs,i))}i.length&&xt.updateTimeline(),e&&i.length&&e(i)},j=function(t,n){var o={},i=[],r=99999999,s=-1;for(var u in n){var a=o[n[u].ToGroupId];a||(a=o[n[u].ToGroupId]={min:r,max:s,msgs:[]}),n[u].NoticeSeq>c&&(he.warn("noticeSeq="+c+",msgNoticeSeq="+n[u].NoticeSeq),c=n[u].NoticeSeq),n[u].Event=t,o[n[u].ToGroupId].msgs.push(n[u]),n[u].MsgSeq<a.min&&(o[n[u].ToGroupId].min=n[u].MsgSeq),n[u].MsgSeq>a.max&&(o[n[u].ToGroupId].max=n[u].MsgSeq)}for(var l in o){var p=o[l].max-o[l].min+1,g=_[l];g?o[l].min-g>1||o[l].msgs.length<p?(he.warn("发起一次补齐群消息请求,curMaxMsgSeq="+g+", minMsgSeq="+o[l].min+", maxMsgSeq="+o[l].max+", msgs.length="+o[l].msgs.length+", tempCount="+p),L(l,o[l].max,o[l].max-g),U(l,o[l].max)):i=D(o[l].msgs,i):(he.warn("不存在该群的最大消息seq，群id="+l),o[l].msgs.length<p?(he.warn("发起一次补齐群消息请求,minMsgSeq="+o[l].min+", maxMsgSeq="+o[l].max+", msgs.length="+o[l].msgs.length+", tempCount="+p),L(l,o[l].max,p),U(l,o[l].max)):i=D(o[l].msgs,i))}i.length&&xt.updateTimeline(),e&&i.length&&e(i)},Q=function(e,t){for(var n in e){var i=e[n],r=i.MsgBody,s=r.ReportType;0==t&&i.NoticeSeq&&i.NoticeSeq>c&&(c=i.NoticeSeq);i.GroupInfo.To_Account;if(t){var u=i.ToGroupId+"_"+s+"_"+r.Operator_Account,a=y[u];if(a){he.warn("收到重复的群系统消息：key="+u);continue}y[u]=!0}var l={SrcFlag:0,ReportType:s,GroupId:i.ToGroupId,GroupName:i.GroupInfo.GroupName,Operator_Account:r.Operator_Account,MsgTime:i.MsgTimeStamp,groupReportTypeMsg:r};switch(s){case G.JOIN_GROUP_REQUEST:l.RemarkInfo=r.RemarkInfo,l.MsgKey=r.MsgKey,l.Authentication=r.Authentication,l.UserDefinedField=i.UserDefinedField,l.From_Account=i.From_Account,l.MsgSeq=i.ClientSeq,l.MsgRandom=i.MsgRandom;break;case G.JOIN_GROUP_ACCEPT:case G.JOIN_GROUP_REFUSE:l.RemarkInfo=r.RemarkInfo;break;case G.KICK:case G.DESTORY:case G.CREATE:case G.INVITED_JOIN_GROUP_REQUEST:case G.INVITED_JOIN_GROUP_REQUEST_AGREE:case G.QUIT:case G.SET_ADMIN:case G.CANCEL_ADMIN:case G.REVOKE:break;case G.READED:break;case G.CUSTOM:l.MsgSeq=i.MsgSeq,l.UserDefinedField=r.UserDefinedField;break;default:he.error("未知群系统消息类型：reportType="+s)}if(t)s==G.JOIN_GROUP_REQUEST&&o[s]&&o[s](l);else if(o[s])if(s==G.READED)for(var p=l.groupReportTypeMsg.GroupReadInfoArray,g=0,f=p.length;g<f;g++){var d=p[g];o[s](d)}else o[s](l)}},W=function(e,t){var n,o,r;for(var s in e){switch(n=e[s],o=n.PushType,0==t&&n.NoticeSeq&&n.NoticeSeq>c&&(c=n.NoticeSeq),r={Type:o},o){case N.FRIEND_ADD:r.Accounts=n.FriendAdd_Account;break;case N.FRIEND_DELETE:r.Accounts=n.FriendDel_Account;break;case N.PENDENCY_ADD:r.PendencyList=n.PendencyAdd;break;case N.PENDENCY_DELETE:r.Accounts=n.FrienPencydDel_Account;break;case N.BLACK_LIST_ADD:r.Accounts=n.BlackListAdd_Account;break;case N.BLACK_LIST_DELETE:r.Accounts=n.BlackListDel_Account;break;default:he.error("未知好友系统通知类型：friendNotice="+JSON.stringify(n))}t?o==N.PENDENCY_ADD&&i[o]&&i[o](r):i[o]&&i[o](r)}},Z=function(e,t){var n,o,i;for(var s in e){switch(n=e[s],o=n.PushType,0==t&&n.NoticeSeq&&n.NoticeSeq>c&&(c=n.NoticeSeq),i={Type:o},o){case F.PROFILE_MODIFY:i.Profile_Account=n.Profile_Account,i.ProfileList=n.ProfileList;break;default:he.error("未知资料系统通知类型：profileNotice="+JSON.stringify(n))}t?o==F.PROFILE_MODIFY&&r[o]&&r[o](i):r[o]&&r[o](i)}},$=function(e){var t=e.MsgBody,n=t.ReportType,i=(e.GroupInfo.To_Account,{SrcFlag:1,ReportType:n,GroupId:e.ToGroupId,GroupName:e.GroupInfo.GroupName,Operator_Account:t.Operator_Account,MsgTime:e.MsgTimeStamp});switch(n){case G.JOIN_GROUP_REQUEST:i.RemarkInfo=t.RemarkInfo,i.MsgKey=t.MsgKey,i.Authentication=t.Authentication,i.UserDefinedField=e.UserDefinedField,i.From_Account=e.From_Account,i.MsgSeq=e.ClientSeq,i.MsgRandom=e.MsgRandom;break;case G.JOIN_GROUP_ACCEPT:case G.JOIN_GROUP_REFUSE:i.RemarkInfo=t.RemarkInfo;break;case G.KICK:case G.DESTORY:case G.CREATE:case G.INVITED_JOIN_GROUP_REQUEST:case G.INVITED_JOIN_GROUP_REQUEST_AGREE:case G.QUIT:case G.SET_ADMIN:case G.CANCEL_ADMIN:case G.REVOKE:break;case G.CUSTOM:i.MsgSeq=e.MsgSeq,i.UserDefinedField=t.UserDefinedField;break;default:he.error("未知群系统消息类型：reportType="+n)}o[n]&&o[n](i)},ie=function(e){for(var t=0,n=e.length;t<n;t++)re(e[t])},re=function(e){var t=e.SubMsgType;switch(t){case A.READED:break;default:he.error("未知C2c系统消息：reportType="+reportType)}if(e.ReadC2cMsgNotify.UinPairReadArray&&onC2cEventCallbacks[t])for(var n=0,o=e.ReadC2cMsgNotify.UinPairReadArray.length;n<o;n++){var i=e.ReadC2cMsgNotify.UinPairReadArray[n];onC2cEventCallbacks[t](i)}};this.longPolling=function(e,t){function n(){ke(o,function(e){for(var t in e.EventArray){var n=e.EventArray[t];switch(n.Event){case T.C2C:a=n.NotifySeq,he.warn("longpolling: received new c2c msg"),Bt.syncMsgs();break;case T.GROUP_COMMON:he.warn("longpolling: received new group msgs"),j(n.Event,n.GroupMsgArray);break;case T.GROUP_TIP:he.warn("longpolling: received new group tips"),j(n.Event,n.GroupTips);break;case T.GROUP_SYSTEM:he.warn("longpolling: received new group system msgs"),Q(n.GroupTips,!1);break;case T.FRIEND_NOTICE:he.warn("longpolling: received new friend system notice"),W(n.FriendListMod,!1);break;case T.PROFILE_NOTICE:he.warn("longpolling: received new profile system notice"),Z(n.ProfileDataMod,!1);break;case T.C2C_COMMON:c=n.C2cMsgArray[0].NoticeSeq,he.warn("longpolling: received new c2c_common msg",c),X(n.Event,n.C2cMsgArray);break;case T.C2C_EVENT:c=n.C2cNotifyMsgArray[0].NoticeSeq,he.warn("longpolling: received new c2c_event msg"),ie(n.C2cNotifyMsgArray);break;default:he.error("longpolling收到未知新消息类型: Event="+n.Event)}}var o={ActionStatus:f.OK,ErrorCode:0};se(o)},function(e){se(e),t&&t(e)})}var o={Timeout:B/1e3,Cookie:{NotifySeq:a,NoticeSeq:c}};J?(o.Cookie.LongPollingId=J,n()):Pt({},function(e){J=o.Cookie.LongPollingId=e.LongPollingId,B=e.Timeout>60?B:1e3*e.Timeout,n()})},this.bigGroupLongPolling=function(e,n){var o=t,i={StartSeq:d,HoldTime:h,Key:I};qe(i,function(n){if(o==t){var i=[];if(d=n.NextSeq,h=n.HoldTime,I=n.Key,n.RspMsgList&&n.RspMsgList.length>0){for(var r,s,u,a=0,c=n.RspMsgList.length-1;c>=0;c--)if(r=n.RspMsgList[c],!r.IsPlaceMsg&&r.From_Account&&r.MsgBody&&0!=r.MsgBody.length)switch(s=r.Event){case T.GROUP_COMMON:he.info("bigGroupLongPolling: return new group msg"),u=ce(r,!1,!1),u&&i.push(u),a+=1;break;case T.GROUP_TIP:case T.GROUP_TIP2:he.info("bigGroupLongPolling: return new group tip"),u=ce(r,!1,!1),u&&i.push(u);break;case T.GROUP_SYSTEM:he.info("bigGroupLongPolling: new group system msg"),$(r);break;default:he.error("bigGroupLongPolling收到未知新消息类型: Event="+s)}a>0&&(Bt.setBigGroupLongPollingMsgMap(r.ToGroupId,a),he.warn("current bigGroupLongPollingMsgMap: "+JSON.stringify(E)))}z=0;var l={ActionStatus:f.OK,ErrorCode:P.ON,ErrorInfo:"connection is ok..."};wt.callBack(l),e?e(i):p&&p(i),g&&Bt.bigGroupLongPolling()}},function(e){if(e.ErrorCode!=V&&(he.error(e.ErrorInfo),z++),e.ErrorCode!=H&&(he.error("多实例登录，被kick"),s&&s()),z<Y)g&&Bt.bigGroupLongPolling();else{var t={ActionStatus:f.FAIL,ErrorCode:P.OFF,ErrorInfo:"connection is off"};wt.callBack(t)}n&&n(e)},1e3*h)};var se=function(e){if(0==e.ErrorCode||e.ErrorCode==V){x=0,q=!1;var t,n=!1;switch(k){case P.INIT:n=!0,k=P.ON,t="create connection successfully(INIT->ON)";break;case P.ON:t="connection is on...(ON->ON)";break;case P.RECONNECT:k=P.ON,t="connection is on...(RECONNECT->ON)";break;case P.OFF:n=!0,k=P.RECONNECT,t="reconnect successfully(OFF->RECONNECT)"}var o={ActionStatus:f.OK,ErrorCode:k,ErrorInfo:t};n&&wt.callBack(o),u&&Bt.longPolling()}else if(e.ErrorCode==H)he.error("多实例登录，被kick"),s&&s();else if(x++,he.warn("longPolling接口第"+x+"次报错: "+e.ErrorInfo),x<=Y)setTimeout(ue,100);else{k=P.OFF;var i={ActionStatus:f.FAIL,ErrorCode:P.OFF,ErrorInfo:"connection is off"};0==q&&wt.callBack(i),q=!0,he.warn(K+"毫秒之后,SDK会发起新的longPolling请求..."),setTimeout(ue,K)}},X=function(t,n){var o=[],i=[];i=n;for(var r in i){var s,u,a,c=i[r];c.From_Account==oe.identifier?(s=!0,u=c.To_Account,a=""):(s=!1,u=c.From_Account,a="");var p=xt.sessByTypeId(l.C2C,u);p||(p=new Ut(l.C2C,u,u,a,0,0));var g=new qt(p,s,c.MsgSeq,c.MsgRandom,c.MsgTimeStamp,c.From_Account),f=null,d=null,h=null;for(var I in c.MsgBody){switch(f=c.MsgBody[I],h=f.MsgType){case m.TEXT:d=new qt.Elem.Text(f.MsgContent.Text);break;case m.FACE:d=new qt.Elem.Face(f.MsgContent.Index,f.MsgContent.Data);break;case m.IMAGE:d=new qt.Elem.Images(f.MsgContent.UUID);for(var E in f.MsgContent.ImageInfoArray){var M=f.MsgContent.ImageInfoArray[E];d.addImage(new qt.Elem.Images.Image(M.Type,M.Size,M.Width,M.Height,M.URL))}break;case m.SOUND:f.MsgContent?d=new qt.Elem.Sound(f.MsgContent.UUID,f.MsgContent.Second,f.MsgContent.Size,c.From_Account,c.To_Account,f.MsgContent.Download_Flag,l.C2C):(h=m.TEXT,d=new qt.Elem.Text("[语音消息]下载地址解析出错"));break;case m.LOCATION:d=new qt.Elem.Location(f.MsgContent.Longitude,f.MsgContent.Latitude,f.MsgContent.Desc);break;case m.FILE:case m.FILE+" ":h=m.FILE,f.MsgContent?d=new qt.Elem.File(f.MsgContent.UUID,f.MsgContent.FileName,f.MsgContent.FileSize,c.From_Account,c.To_Account,f.MsgContent.Download_Flag,l.C2C):(h=m.TEXT,d=new qt.Elem.Text("[文件消息下载地址解析出错]"));break;case m.CUSTOM:try{var _=JSON.parse(f.MsgContent.Data);if(_&&_.userAction&&_.userAction==w.ING)continue}catch(e){}h=m.CUSTOM,d=new qt.Elem.Custom(f.MsgContent.Data,f.MsgContent.Desc,f.MsgContent.Ext);break;default:h=m.TEXT,d=new qt.Elem.Text("web端暂不支持"+f.MsgType+"消息")}g.elems.push(new qt.Elem(h,d))}g.elems.length>0&&xt.addMsg(g)&&o.push(g)}o.length>0&&xt.updateTimeline(),o.length>0&&e&&e(o)},ue=function(){u&&Bt.longPolling()},ae=function(e){for(var t in e){var n=e[t];switch(Q(n.GroupTips,!0),n.Event){case T.GROUP_SYSTEM:he.warn("handlerApplyJoinGroupSystemMsgs： handler new group system msg"),Q(n.GroupTips,!0);break;default:he.error("syncMsgs收到未知的群系统消息类型: Event="+n.Event)}}};this.syncMsgs=function(t,n){var o=[],i=[];xe(xt.cookie,xt.syncFlag,function(n){2==n.SyncFlag&&(xt.syncFlag=0),i=n.MsgList,xt.cookie=n.Cookie;for(var r in i){var s,u,a,c=i[r];c.From_Account==oe.identifier?(s=!0,u=c.To_Account,a=""):(s=!1,u=c.From_Account,a="");var p=xt.sessByTypeId(l.C2C,u);p||(p=new Ut(l.C2C,u,u,a,0,0));var g=new qt(p,s,c.MsgSeq,c.MsgRandom,c.MsgTimeStamp,c.From_Account),f=null,d=null,h=null;for(var I in c.MsgBody){switch(f=c.MsgBody[I],h=f.MsgType){case m.TEXT:d=new qt.Elem.Text(f.MsgContent.Text);break;case m.FACE:d=new qt.Elem.Face(f.MsgContent.Index,f.MsgContent.Data);break;case m.IMAGE:d=new qt.Elem.Images(f.MsgContent.UUID);for(var E in f.MsgContent.ImageInfoArray){var M=f.MsgContent.ImageInfoArray[E];d.addImage(new qt.Elem.Images.Image(M.Type,M.Size,M.Width,M.Height,M.URL))}break;case m.SOUND:f.MsgContent?d=new qt.Elem.Sound(f.MsgContent.UUID,f.MsgContent.Second,f.MsgContent.Size,c.From_Account,c.To_Account,f.MsgContent.Download_Flag,l.C2C):(h=m.TEXT,d=new qt.Elem.Text("[语音消息]下载地址解析出错"));break;case m.LOCATION:d=new qt.Elem.Location(f.MsgContent.Longitude,f.MsgContent.Latitude,f.MsgContent.Desc);break;case m.FILE:case m.FILE+" ":h=m.FILE,f.MsgContent?d=new qt.Elem.File(f.MsgContent.UUID,f.MsgContent.FileName,f.MsgContent.FileSize,c.From_Account,c.To_Account,f.MsgContent.Download_Flag,l.C2C):(h=m.TEXT,d=new qt.Elem.Text("[文件消息下载地址解析出错]"));break;case m.CUSTOM:try{var _=JSON.parse(f.MsgContent.Data);if(_&&_.userAction&&_.userAction==w.ING)continue}catch(e){}h=m.CUSTOM,d=new qt.Elem.Custom(f.MsgContent.Data,f.MsgContent.Desc,f.MsgContent.Ext);break;default:h=m.TEXT,d=new qt.Elem.Text("web端暂不支持"+f.MsgType+"消息")}g.elems.push(new qt.Elem(h,d))}g.elems.length>0&&xt.addMsg(g)&&o.push(g)}ae(n.EventArray),o.length>0&&xt.updateTimeline(),t?t(o):o.length>0&&e&&e(o)},function(e){he.error("getMsgs failed:"+e.ErrorInfo),n&&n(e)})},this.getC2CHistoryMsgs=function(e,t,n){if(!e.Peer_Account&&n)return void n(me.getReturnError("Peer_Account is empty",-13));if(e.MaxCnt||(e.MaxCnt=15),e.MaxCnt<=0&&n)return void n(me.getReturnError("MaxCnt should be greater than 0",-14));if(e.MaxCnt>15){if(n)return void n(me.getReturnError("MaxCnt can not be greater than 15",-15))}else{null!=e.MsgKey&&void 0!==e.MsgKey||(e.MsgKey="");var o={Peer_Account:e.Peer_Account,MaxCnt:e.MaxCnt,LastMsgTime:e.LastMsgTime,MsgKey:e.MsgKey};Ve(o,function(n){var o=[],i=[];i=n.MsgList;var r=xt.sessByTypeId(l.C2C,e.Peer_Account);r||(r=new Ut(l.C2C,e.Peer_Account,e.Peer_Account,"",0,0));for(var s in i){var u,a,c,p=i[s];p.From_Account==oe.identifier?(u=!0,a=p.To_Account,c=""):(u=!1,a=p.From_Account,c="");var g=new qt(r,u,p.MsgSeq,p.MsgRandom,p.MsgTimeStamp,p.From_Account),f=null,d=null,h=null;for(var I in p.MsgBody){switch(f=p.MsgBody[I],h=f.MsgType){case m.TEXT:d=new qt.Elem.Text(f.MsgContent.Text);break;case m.FACE:d=new qt.Elem.Face(f.MsgContent.Index,f.MsgContent.Data);break;case m.IMAGE:d=new qt.Elem.Images(f.MsgContent.UUID);for(var E in f.MsgContent.ImageInfoArray){var M=f.MsgContent.ImageInfoArray[E];d.addImage(new qt.Elem.Images.Image(M.Type,M.Size,M.Width,M.Height,M.URL))}break;case m.SOUND:f.MsgContent?d=new qt.Elem.Sound(f.MsgContent.UUID,f.MsgContent.Second,f.MsgContent.Size,p.From_Account,p.To_Account,f.MsgContent.Download_Flag,l.C2C):(h=m.TEXT,
d=new qt.Elem.Text("[语音消息]下载地址解析出错"));break;case m.LOCATION:d=new qt.Elem.Location(f.MsgContent.Longitude,f.MsgContent.Latitude,f.MsgContent.Desc);break;case m.FILE:case m.FILE+" ":h=m.FILE,f.MsgContent?d=new qt.Elem.File(f.MsgContent.UUID,f.MsgContent.FileName,f.MsgContent.FileSize,p.From_Account,p.To_Account,f.MsgContent.Download_Flag,l.C2C):(h=m.TEXT,d=new qt.Elem.Text("[文件消息下载地址解析出错]"));break;case m.CUSTOM:h=m.CUSTOM,d=new qt.Elem.Custom(f.MsgContent.Data,f.MsgContent.Desc,f.MsgContent.Ext);break;default:h=m.TEXT,d=new qt.Elem.Text("web端暂不支持"+f.MsgType+"消息")}g.elems.push(new qt.Elem(h,d))}xt.addMsg(g),o.push(g)}if(xt.updateTimeline(),t){var _={Complete:n.Complete,MsgCount:o.length,LastMsgTime:n.LastMsgTime,MsgKey:n.MsgKey,MsgList:o};r.isFinished(n.Complete),t(_)}},function(e){he.error("getC2CHistoryMsgs failed:"+e.ErrorInfo),n&&n(e)})}},this.syncGroupMsgs=function(t,n,o){if(t.ReqMsgSeq<=0){if(o){var i="ReqMsgSeq must be greater than 0",r=me.getReturnError(i,-16);o(r)}}else{var s={GroupId:t.GroupId,ReqMsgSeq:t.ReqMsgSeq,ReqMsgNumber:t.ReqMsgNumber};dt(s,function(t){var o=[],i=(t.GroupId,t.RspMsgList),r=t.IsFinished;if(null==i||void 0===i)return void(n&&n([]));for(var s=i.length-1;s>=0;s--){var u=i[s];if(!u.IsPlaceMsg&&u.From_Account&&u.MsgBody&&0!=u.MsgBody.length){var a=ce(u,!0,!0,r);a&&o.push(a)}}o.length>0&&xt.updateTimeline(),n?n(o):o.length>0&&e&&e(o)},function(e){he.error("getGroupMsgs failed:"+e.ErrorInfo),o&&o(e)})}};var ce=function(e,t,o,i){if(e.IsPlaceMsg||!e.From_Account||!e.MsgBody||0==e.MsgBody.length)return null;var r,s,u,a,c,p=e.ToGroupId,g=p;e.GroupInfo&&e.GroupInfo.GroupName&&(g=e.GroupInfo.GroupName),a=e.From_Account,e.GroupInfo&&(e.GroupInfo.From_AccountNick&&(a=e.GroupInfo.From_AccountNick),c=e.GroupInfo.From_AccountHeadurl?e.GroupInfo.From_AccountHeadurl:null),e.From_Account==oe.identifier?(r=!0,s=e.From_Account,u=""):(r=!1,s=e.From_Account,u="");var f=xt.sessByTypeId(l.GROUP,p);f||(f=new Ut(l.GROUP,p,g,u,0,0)),"undefined"!=typeof i&&f.isFinished(i||0);var d=S.COMMON;if(T.GROUP_TIP==e.Event||T.GROUP_TIP2==e.Event){d=S.TIP;var h=e.MsgBody;e.MsgBody=[],e.MsgBody.push({MsgType:m.GROUP_TIP,MsgContent:h})}else e.MsgPriority&&(e.MsgPriority==v.REDPACKET?d=S.REDPACKET:e.MsgPriority==v.LOVEMSG&&(d=S.LOVEMSG));var I=new qt(f,r,e.MsgSeq,e.MsgRandom,e.MsgTimeStamp,e.From_Account,d,a,c),E=null,M=null,_=null;for(var y in e.MsgBody){switch(E=e.MsgBody[y],_=E.MsgType){case m.TEXT:M=new qt.Elem.Text(E.MsgContent.Text);break;case m.FACE:M=new qt.Elem.Face(E.MsgContent.Index,E.MsgContent.Data);break;case m.IMAGE:M=new qt.Elem.Images(E.MsgContent.UUID);for(var C in E.MsgContent.ImageInfoArray)M.addImage(new qt.Elem.Images.Image(E.MsgContent.ImageInfoArray[C].Type,E.MsgContent.ImageInfoArray[C].Size,E.MsgContent.ImageInfoArray[C].Width,E.MsgContent.ImageInfoArray[C].Height,E.MsgContent.ImageInfoArray[C].URL));break;case m.SOUND:E.MsgContent?M=new qt.Elem.Sound(E.MsgContent.UUID,E.MsgContent.Second,E.MsgContent.Size,e.From_Account,e.To_Account,E.MsgContent.Download_Flag,l.GROUP):(_=m.TEXT,M=new qt.Elem.Text("[语音消息]下载地址解析出错"));break;case m.LOCATION:M=new qt.Elem.Location(E.MsgContent.Longitude,E.MsgContent.Latitude,E.MsgContent.Desc);break;case m.FILE:case m.FILE+" ":_=m.FILE;Re(E.MsgContent.UUID,e.From_Account,E.MsgContent.FileName);E.MsgContent?M=new qt.Elem.File(E.MsgContent.UUID,E.MsgContent.FileName,E.MsgContent.FileSize,e.From_Account,e.To_Account,E.MsgContent.Download_Flag,l.GROUP):(_=m.TEXT,M=new qt.Elem.Text("[文件消息]地址解析出错"));break;case m.GROUP_TIP:var A=E.MsgContent.OpType;if(M=new qt.Elem.GroupTip(A,E.MsgContent.Operator_Account,p,e.GroupInfo.GroupName,E.MsgContent.List_Account,E.MsgContent.MsgMemberExtraInfo),O.JOIN==A||O.QUIT==A)M.setGroupMemberNum(E.MsgContent.MemberNum);else if(O.MODIFY_GROUP_INFO==A){var G=!1,N={GroupId:p,GroupFaceUrl:null,GroupName:null,OwnerAccount:null,GroupNotification:null,GroupIntroduction:null},F=E.MsgContent.MsgGroupNewInfo;if(F.GroupFaceUrl){var b=new qt.Elem.GroupTip.GroupInfo(R.FACE_URL,F.GroupFaceUrl);M.addGroupInfo(b),G=!0,N.GroupFaceUrl=F.GroupFaceUrl}if(F.GroupName){var P=new qt.Elem.GroupTip.GroupInfo(R.NAME,F.GroupName);M.addGroupInfo(P),G=!0,N.GroupName=F.GroupName}if(F.Owner_Account){var L=new qt.Elem.GroupTip.GroupInfo(R.OWNER,F.Owner_Account);M.addGroupInfo(L),G=!0,N.OwnerAccount=F.Owner_Account}if(F.GroupNotification){var w=new qt.Elem.GroupTip.GroupInfo(R.NOTIFICATION,F.GroupNotification);M.addGroupInfo(w),G=!0,N.GroupNotification=F.GroupNotification}if(F.GroupIntroduction){var U=new qt.Elem.GroupTip.GroupInfo(R.INTRODUCTION,F.GroupIntroduction);M.addGroupInfo(U),G=!0,N.GroupIntroduction=F.GroupIntroduction}0==t&&G&&n&&n(N)}else if(O.MODIFY_MEMBER_INFO==A){var D=E.MsgContent.MsgMemberInfo;for(var k in D){var q=D[k];M.addMemberInfo(new qt.Elem.GroupTip.MemberInfo(q.User_Account,q.ShutupTime))}}break;case m.CUSTOM:_=m.CUSTOM,M=new qt.Elem.Custom(E.MsgContent.Data,E.MsgContent.Desc,E.MsgContent.Ext);break;default:_=m.TEXT,M=new qt.Elem.Text("web端暂不支持"+E.MsgType+"消息")}I.elems.push(new qt.Elem(_,M))}return 0==o?I:xt.addMsg(I)?I:null};this.init=function(t,a,c){if(t.onMsgNotify||he.warn("listeners.onMsgNotify is empty"),e=t.onMsgNotify,t.onBigGroupMsgNotify?p=t.onBigGroupMsgNotify:he.warn("listeners.onBigGroupMsgNotify is empty"),t.onC2cEventNotifys?onC2cEventCallbacks=t.onC2cEventNotifys:he.warn("listeners.onC2cEventNotifys is empty"),t.onGroupSystemNotifys?o=t.onGroupSystemNotifys:he.warn("listeners.onGroupSystemNotifys is empty"),t.onGroupInfoChangeNotify?n=t.onGroupInfoChangeNotify:he.warn("listeners.onGroupInfoChangeNotify is empty"),t.onFriendSystemNotifys?i=t.onFriendSystemNotifys:he.warn("listeners.onFriendSystemNotifys is empty"),t.onProfileSystemNotifys?r=t.onProfileSystemNotifys:he.warn("listeners.onProfileSystemNotifys is empty"),t.onKickedEventCall?s=t.onKickedEventCall:he.warn("listeners.onKickedEventCall is empty"),t.onAppliedDownloadUrl?onAppliedDownloadUrl=t.onAppliedDownloadUrl:he.warn("listeners.onAppliedDownloadUrl is empty"),oe.identifier&&oe.userSig)b(function(e){he.info("initMyGroupMaxSeqs success"),C(function(e){if(he.info("initIpAndAuthkey success"),a){he.info("login success(have login state))");var t={ActionStatus:f.OK,ErrorCode:0,ErrorInfo:"login success"};a(t)}Bt.setLongPollingOn(!0),u&&Bt.longPolling(a)},c)},c);else if(a){var l={ActionStatus:f.OK,ErrorCode:0,ErrorInfo:"login success(no login state)"};a(l)}},this.sendMsg=function(e,t,n){De(e,function(o){if(e.sess.type()==l.C2C){if(!xt.addMsg(e)){var i="sendMsg: addMsg failed!",r=me.getReturnError(i,-17);return he.error(i),void(n&&n(r))}xt.updateTimeline()}t&&t(o)},function(e){n&&n(e)})}},Kt=new function(){this.fileMd5=null;var e=function(e,t,n){function o(){var t=a*s,n=t+s>=e.size?e.size:t+s,o=r.call(e,t,n);i.readAsArrayBuffer(o)}var i=null;try{i=new FileReader}catch(e){if(n)return void n(me.getReturnError("当前浏览器不支持FileReader",-18))}var r=File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice;if(!r&&n)return void n(me.getReturnError("当前浏览器不支持FileAPI",-19));var s=2097152,u=Math.ceil(e.size/s),a=0,c=new SparkMD5;i.onload=function(e){for(var n="",i=new Uint8Array(e.target.result),r=i.byteLength,s=0;s<r;s++)n+=String.fromCharCode(i[s]);c.appendBinary(n),a++,a<u?o():(this.fileMd5=c.end(),t&&t(this.fileMd5))},o()};this.submitUploadFileForm=function(e,t,n){function o(e,t){var n=document.createElement("input");n.type="hidden",n.name=e,n.value=t,d.appendChild(n)}function i(){var e;try{e=JSON.parse(h.contentWindow.name)||{}}catch(t){e={}}e.ActionStatus?(h.src="about:blank",h.parentNode.removeChild(h),h=null,e.ActionStatus==f.OK?t&&t(e):n&&n(e)):setTimeout(i,100)}var r,s,u=e.formId,a=e.fileId,c=$++,l="uploadResultIframe_"+c,p=e.To_Account,g=e.businessType,d=document.getElementById(u);if(!d)return r="获取表单对象为空: formId="+u+"(formId非法)",s=me.getReturnError(r,-20),void(n&&n(s));var m=document.getElementById(a);if(!m)return r="获取文件对象为空: fileId="+a+"(没有选择文件或者fileId非法)",s=me.getReturnError(r,-21),void(n&&n(s));m.name="file";var h=document.createElement("iframe");h.name=l,h.id=l,h.style.display="none",document.body.appendChild(h);var E;E=Se()?"pic_up":"pic_up_test";var M="https://pic.tim.qq.com/v4/openpic/"+E+"?tinyid="+oe.tinyid+"&a2="+oe.a2+"&sdkappid="+oe.sdkAppID+"&accounttype="+oe.accountType+"&contenttype=http";d.action=M,d.method="post",d.target=l,o("App_Version",y.APP_VERSION),o("From_Account",oe.identifier),o("To_Account",p),o("Seq",Ee().toString()),o("Timestamp",Ie().toString()),o("Random",Me().toString()),o("Busi_Id",g),o("PkgFlag",I.RAW_DATA.toString()),o("Auth_Key",te),o("Server_Ver",y.SERVER_VERSION.toString()),o("File_Type",e.fileType),setTimeout(i,500),d.submit()},this.uploadFile=function(t,n,o){var i={init:function(e,t,n){var o=this;o.file=e.file,o.onProgressCallBack=e.onProgressCallBack,e.abortButton&&(e.abortButton.onclick=o.abortHandler),o.total=o.file.size,o.loaded=0,o.step=1105920,o.sliceSize=0,o.sliceOffset=0,o.timestamp=Ie(),o.seq=Ee(),o.random=Me(),o.fromAccount=oe.identifier,o.toAccount=e.To_Account,o.fileMd5=e.fileMd5,o.businessType=e.businessType,o.fileType=e.fileType,o.cbOk=t,o.cbErr=n,o.reader=new FileReader,o.blobSlice=File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice,o.reader.onloadstart=o.onLoadStart,o.reader.onprogress=o.onProgress,o.reader.onabort=o.onAbort,o.reader.onerror=o.onerror,o.reader.onload=o.onLoad,o.reader.onloadend=o.onLoadEnd},upload:function(){var e=i;e.readBlob(0)},onLoadStart:function(){},onProgress:function(e){var t=i;t.loaded+=e.loaded,t.onProgressCallBack&&t.onProgressCallBack(t.loaded,t.total)},onAbort:function(){},onError:function(){},onLoad:function(e){var t=i;if(e.target.readyState==FileReader.DONE){var n=e.target.result,o=n.indexOf(",");o!=-1&&(n=n.substr(o+1));var r={From_Account:t.fromAccount,To_Account:t.toAccount,Busi_Id:t.businessType,File_Type:t.fileType,File_Str_Md5:t.fileMd5,PkgFlag:I.BASE64_DATA,File_Size:t.total,Slice_Offset:t.sliceOffset,Slice_Size:t.sliceSize,Slice_Data:n,Seq:t.seq,Timestamp:t.timestamp,Random:t.random},s=function(e){if(0==e.IsFinish)t.loaded=e.Next_Offset,t.loaded<t.total?t.readBlob(t.loaded):t.loaded=t.total;else if(t.cbOk){var n={ActionStatus:e.ActionStatus,ErrorCode:e.ErrorCode,ErrorInfo:e.ErrorInfo,File_UUID:e.File_UUID,File_Size:e.Next_Offset,URL_INFO:e.URL_INFO,Download_Flag:e.Download_Flag};t.fileType==_.FILE&&(n.URL_INFO=Re(e.File_UUID,oe.identifier,t.file.name)),t.cbOk(n)}X=0},u=function(e){X<j?(X++,setTimeout(function(){Nt(r,s,u)},1e3)):t.cbErr(e)};Nt(r,s,u)}},onLoadEnd:function(){},readBlob:function(e){var t,n=i,o=n.file,r=e+n.step;r>n.total?(r=n.total,n.sliceSize=r-e):n.sliceSize=n.step,n.sliceOffset=e,t=n.blobSlice.call(o,e,r),n.reader.readAsDataURL(t)},abortHandler:function(){var e=i;e.reader&&e.reader.abort()}};e(t.file,function(e){he.info("fileMd5: "+e),t.fileMd5=e,i.init(t,n,o),i.upload()},o)}};e.SESSION_TYPE=l,e.MSG_MAX_LENGTH=g,e.C2C_MSG_SUB_TYPE=C,e.GROUP_MSG_SUB_TYPE=S,e.MSG_ELEMENT_TYPE=m,e.GROUP_TIP_TYPE=O,e.IMAGE_TYPE=h,e.GROUP_SYSTEM_TYPE=G,e.FRIEND_NOTICE_TYPE=N,e.GROUP_TIP_MODIFY_GROUP_INFO_TYPE=R,e.BROWSER_INFO=r,e.Emotions=e.EmotionPicData=de,e.EmotionDataIndexs=e.EmotionPicDataIndex=fe,e.TLS_ERROR_CODE=b,e.CONNECTION_STATUS=P,e.UPLOAD_PIC_BUSSINESS_TYPE=L,e.RECENT_CONTACT_TYPE=p,e.UPLOAD_RES_TYPE=_,e.Tool=me,e.Log=he,e.Msg=qt,e.Session=Ut,e.MsgStore={sessMap:function(){return xt.sessMap()},sessCount:function(){return xt.sessCount()},sessByTypeId:function(e,t){return xt.sessByTypeId(e,t)},delSessByTypeId:function(e,t){return xt.delSessByTypeId(e,t)},resetCookieAndSyncFlag:function(){return xt.resetCookieAndSyncFlag()}},e.Resources=ge,e.login=e.init=function(e,t,n,o,i){wt.init(t.onConnNotify,o,i),t.jsonpCallback&&(Z=t.jsonpCallback),be(e,t,n,o,i)},e.logout=e.offline=function(e,t){return Ue("instance",e,t)},e.logoutAll=function(e,t){return Ue("all",e,t)},e.sendMsg=function(e,t,n){return Bt.sendMsg(e,t,n)},e.syncMsgs=function(e,t){return Bt.syncMsgs(e,t)},e.getC2CHistoryMsgs=function(e,t,n){return Bt.getC2CHistoryMsgs(e,t,n)},e.syncGroupMsgs=function(e,t,n){return Bt.syncGroupMsgs(e,t,n)},e.c2CMsgReaded=function(e,t,n){return xt.c2CMsgReaded(e,t,n)},e.groupMsgReaded=function(e,t,n){return mt(e,t,n)},e.setAutoRead=function(e,t,n){return xt.setAutoRead(e,t,n)},e.createGroup=function(e,t,n){return He(e,t,n)},e.createGroupHigh=function(e,t,n){return Je(e,t,n)},e.applyJoinGroup=function(e,t,n){return Ye(e,t,n)},e.handleApplyJoinGroupPendency=function(e,t,n){return je(e,t,n)},e.getPendencyGroup=function(e,t,n){return Qe(e,t,n)},e.getPendencyGroupRead=function(e,t,n){return We(e,t,n)},e.handleInviteJoinGroupRequest=function(e,t,n){return Ze(e,t,n)},e.deleteApplyJoinGroupPendency=function(e,t,n){return Ke(e,t,n)},e.quitGroup=function(e,t,n){return $e(e,t,n)},e.searchGroupByName=function(e,t,n){return tt(e,t,n)},e.getGroupPublicInfo=function(e,t,n){return nt(e,t,n)},e.getGroupInfo=function(e,t,n){return ot(e,t,n)},e.modifyGroupBaseInfo=function(e,t,n){return ze(e,t,n)},e.getGroupMemberInfo=function(e,t,n){return it(e,t,n)},e.addGroupMember=function(e,t,n){return rt(e,t,n)},e.modifyGroupMember=function(e,t,n){return st(e,t,n)},e.deleteGroupMember=function(e,t,n){return ut(e,t,n)},e.destroyGroup=function(e,t,n){return at(e,t,n)},e.changeGroupOwner=function(e,t,n){return ct(e,t,n)},e.getJoinedGroupListHigh=function(e,t,n){return lt(e,t,n)},e.getRoleInGroup=function(e,t,n){return pt(e,t,n)},e.forbidSendMsg=function(e,t,n){return gt(e,t,n)},e.sendCustomGroupNotify=function(e,t,n){return ft(e,t,n)},e.applyJoinBigGroup=function(e,t,n){return Xe(e,t,n)},e.quitBigGroup=function(e,t,n){return et(e,t,n)},e.getProfilePortrait=function(e,t,n){return At(e,t,n)},e.setProfilePortrait=function(e,t,n){return St(e,t,n)},e.applyAddFriend=function(e,t,n){return It(e,t,n)},e.getPendency=function(e,t,n){return Mt(e,t,n)},e.getPendencyReport=function(e,t,n){return _t(e,t,n)},e.deletePendency=function(e,t,n){return yt(e,t,n)},e.responseFriend=function(e,t,n){return Tt(e,t,n)},e.getAllFriend=function(e,t,n){return Ct(e,t,n)},e.deleteFriend=function(e,t,n){return Et(e,t,n)},e.addBlackList=function(e,t,n){return vt(e,t,n)},e.deleteBlackList=function(e,t,n){return Ot(e,t,n)},e.getBlackList=function(e,t,n){return Rt(e,t,n)},e.getRecentContactList=function(e,t,n){return Gt(e,t,n)},e.uploadFile=e.uploadPic=function(e,t,n){return Kt.uploadFile(e,t,n)},e.submitUploadFileForm=function(e,t,n){return Kt.submitUploadFileForm(e,t,n)},e.uploadFileByBase64=e.uploadPicByBase64=function(e,t,n){var o={To_Account:e.toAccount,Busi_Id:e.businessType,File_Type:e.File_Type,File_Str_Md5:e.fileMd5,PkgFlag:I.BASE64_DATA,File_Size:e.totalSize,Slice_Offset:0,Slice_Size:e.totalSize,Slice_Data:e.base64Str,Seq:Ee(),Timestamp:Ie(),Random:Me()};return Nt(o,t,n)},e.setJsonpLastRspData=function(e){W="string"==typeof e?JSON.parse(e):e},e.getLongPollingId=function(e,t,n){return Pt(e,t,n)},e.applyDownload=function(e,t,n){return Lt(e,t,n)},e.onDownFile=function(e){window.open(ge.downloadMap["uuid_"+e])},e.checkLogin=function(e,t){return Ae(e,t)}}(webim);